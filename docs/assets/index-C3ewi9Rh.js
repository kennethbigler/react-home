import{O,j as s,r as S,M as V,A as X}from"./index-CBROmZqS.js";import{p as q,P as J}from"./PlayerMenu-BU21L4I3.js";import{I as D}from"./InfoPopup-Cv79seuW.js";import{A as _}from"./Add-DNmx2JD1.js";import{R as z}from"./Remove-DTyQl5JD.js";import{b as y,c as f,T as E,a as W}from"./TableRow-DZzrX_x8.js";import{I as P,S as $,T as R}from"./Header-D84sFTh1.js";import{T as F}from"./TableHead-BoN3EeW4.js";import{G as H}from"./Grid2-Ssj-mSCw.js";import{B as K}from"./Button-yQUGJt44.js";import"./Select-WUg9vXwY.js";import"./isMuiElement-BFfwE8Nr.js";import"./useSlotProps-Dd_sFSde.js";import"./useId-B_62EdjF.js";import"./TextField-CfJ4DD0i.js";import"./DialogTitle-D7FzzUVN.js";import"./useThemeProps-CfyK3T0t.js";const C=0,I=13,c={bid:3,blind:!1,train:!1},L={first:0,lastBid:[c,c,c,c],data:[]},Q=O("spadesAtom",L),v=({id:e,blindTrade:a,canTrain:d,bid:n,blind:t,train:r,onBid:i})=>{const l=()=>i(Math.max(n-1,C),!1,!1),x=()=>i(Math.min(n+1,I),!1,!1),o=(b,u)=>i(n,u,!1),m=(b,u)=>i(n,!1,u);return s.jsxs(y,{children:[s.jsx(f,{children:e}),s.jsxs(f,{align:"center",children:[s.jsx(P,{onClick:l,disabled:n<=C,children:s.jsx(z,{})}),n,s.jsx(P,{onClick:x,disabled:n>=I,children:s.jsx(_,{})})]}),s.jsxs(f,{align:"right",children:[s.jsx($,{checked:t,inputProps:{"aria-label":`P${e} Blind Nil`},onChange:o,size:"small"}),a||""]}),s.jsx(f,{align:"right",children:d?s.jsx($,{checked:r,inputProps:{"aria-label":`P${e} Trains`},onChange:m,size:"small"}):null})]})},A=(e,a)=>e<0&&(a===0||a===2)||e>0&&(a===2||a===3)?Math.abs(e):0,U=({blindTrade:e,first:a,initials:d,onBidSave:n})=>{const[t,r]=S.useState([c,c,c,c]),i=(a+0)%4,l=(a+1)%4,x=(a+2)%4,o=(a+3)%4,m=h=>(j,w,M)=>{let B={bid:j,blind:w,train:M};if(w)B={bid:0,blind:w,train:!1};else if(M){let g=10;switch(h){case i:g-=t[x].bid;break;case l:g-=t[o].bid;break;case x:g-=t[i].bid;break;case o:default:g-=t[l].bid}B={bid:g,blind:!1,train:M}}else B={bid:j,blind:!1,train:!1};const T=[...t];T[h]=B,r(T)},b=()=>{n(t),r([c,c,c,c])},u=t.reduce((h,j)=>h-j.bid,13);return s.jsx(D,{title:"+ Bid",onSave:b,children:s.jsxs(E,{"aria-label":"Bid Table",padding:"none",children:[s.jsx(F,{children:s.jsxs(y,{children:[s.jsx(f,{width:"20%",children:"P"}),s.jsxs(f,{width:"40%",align:"center",children:["Bid (",u," 💰)"]}),s.jsx(f,{width:"20%",align:"center",children:"🦮"}),s.jsx(f,{width:"20%",align:"center",children:"🚂"})]})}),s.jsxs(W,{children:[s.jsx(v,{id:d[i],...t[i],onBid:m(i),blindTrade:A(e,i)}),s.jsx(v,{id:d[l],...t[l],onBid:m(l),blindTrade:A(e,l)}),s.jsx(v,{canTrain:0<t[i].bid&&t[i].bid<10,id:d[x],...t[x],blindTrade:A(e,x),onBid:m(x)}),s.jsx(v,{canTrain:0<t[l].bid&&t[l].bid<10,id:d[o],...t[o],blindTrade:A(e,o),onBid:m(o)})]})]})})},k=({initial:e,lastBid:a,made:d,setMade:n})=>{const t=()=>n(Math.max(d-1,C)),r=()=>n(Math.min(d+1,I));return s.jsxs(H,{size:6,children:[s.jsxs(R,{children:[e," Bid: ",a]}),s.jsxs("div",{children:["Made:",s.jsx(P,{onClick:t,disabled:d<=C,children:s.jsx(z,{})}),d,s.jsx(P,{onClick:r,disabled:d>=I,children:s.jsx(_,{})})]})]})},Y=({initials:e,lastBid:a,onScoreSave:d})=>{const[n,t]=S.useState(3),[r,i]=S.useState(3),[l,x]=S.useState(3),[o,m]=S.useState(3),b=n+r+l+o,h=b===13?()=>{d([n,r,l,o]),t(3),i(3),x(3),m(3)}:void 0;return s.jsxs(D,{title:"+ Score",onSave:h,children:[s.jsxs(R,{color:b===13?"success":"warning",align:"center",marginBottom:1,children:[b!==13&&"⚠️"," Tricks: ",b]}),s.jsxs(H,{container:!0,spacing:2,children:[s.jsx(k,{initial:e[0],lastBid:a[0].bid,made:n,setMade:t}),s.jsx(k,{initial:e[1],lastBid:a[1].bid,made:r,setMade:i}),s.jsx(k,{initial:e[2],lastBid:a[2].bid,made:l,setMade:x}),s.jsx(k,{initial:e[3],lastBid:a[3].bid,made:o,setMade:m})]})]})},Z=({blindTrade:e,first:a,initials:d,lastBid:n,onBidSave:t,onScoreSave:r})=>s.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[s.jsx(U,{blindTrade:e,first:a,initials:d,onBidSave:t}),s.jsx(Y,{initials:d,lastBid:n,onScoreSave:r})]}),G=e=>e===void 0||e===0?"":e>0?`${e>100?"🎉 ":""}${e}`:`${e}0 + `,p=({initials:e,data:a})=>s.jsxs(E,{"aria-label":"Bid Table",children:[s.jsx(F,{children:s.jsxs(y,{children:[s.jsx(f,{width:"10%",children:"🥇"}),s.jsxs(f,{children:["Bid",s.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),s.jsx(f,{children:e[0]+e[2]}),s.jsx(f,{children:e[1]+e[3]})]})}),s.jsx(W,{children:a.map((d,n)=>s.jsxs(y,{children:[s.jsxs(f,{padding:n===a.length-1?"none":void 0,align:"center",children:[d.start,n===a.length-1&&(d.score1?"🃏":"🥇")]}),s.jsx(f,{children:d.bid}),s.jsxs(f,{children:[G(d.score1),d.bags1]}),s.jsxs(f,{children:[G(d.score2),d.bags2]})]},n))})]}),N=(e,a,d,n)=>{if(e.blind&&a.blind)return e.made===0&&a.made===0?{score:d+80,bags:n}:{score:d,bags:n+e.made+a.made};if(e.bid===0&&a.bid===0)return e.blind||a.blind?e.made===0&&a.made===0?{score:d+60,bags:n}:e.blind&&e.made===0||a.blind&&a.made===0?{score:d+30,bags:n+e.made+a.made}:e.made===0||a.made===0?{score:d,bags:n+e.made+a.made}:{score:d-30,bags:n+e.made+a.made}:e.made===0&&a.made===0?{score:d+40,bags:n}:e.made===0||a.made===0?{score:d,bags:n+e.made+a.made}:{score:d-20,bags:n+e.made+a.made};let t=0,r=0;if((e.train||a.train)&&e.made+a.made>=10)t=20,r=e.made+a.made-10;else{e.bid===0?e.made===0?t+=e.blind?20:10:(t-=10,r+=e.made):a.bid===0&&(a.made===0?t+=a.blind?20:10:(t-=10,r+=a.made));const i=e.bid+a.bid,l=(e.bid>0?e.made:0)+(a.bid>0?a.made:0);l>=i?(t+=i,r+=l-i):t-=i}return n+r>=10&&(t-=9,r-=10),{score:d+t,bags:n+r}},ee=()=>{const e=V(q),[{first:a,lastBid:d,data:n},t]=X(Q),r=[e[0].name[0],e[1].name[0],e[2].name[0],e[3].name[0]];return{first:a,lastBid:d,data:n,initials:r,addBid:o=>{var u;if(n[n.length-1]&&((u=n[n.length-1])==null?void 0:u.score1)===void 0)return;const m=[...n],b={start:r[a],bid:o.reduce((h,j)=>j.train?h+"🚂":j.blind?h+"🦮":j.bid===0?h+"🚫":j.bid>=10?h+`,${j.bid},`:h+j.bid.toString(),"")};m.push(b),t({first:a,lastBid:o,data:m})},addScore:o=>{var g;if(((g=n[n.length-1])==null?void 0:g.score1)!==void 0)return;const m=[...n],{score1:b,bags1:u,score2:h,bags2:j}=n[n.length-2]||{},{score:w,bags:M}=N({...d[0],made:o[0]},{...d[2],made:o[2]},b||0,u||0),{score:B,bags:T}=N({...d[1],made:o[1]},{...d[3],made:o[3]},h||0,j||0);m[n.length-1]={...n[n.length-1],score1:w,bags1:M,score2:B,bags2:T},t({first:(a+1)%4,lastBid:[c,c,c,c],data:m})},newGame:()=>t({first:a,lastBid:[c,c,c,c],data:[]})}},se=S.memo(()=>{var m,b,u,h,j;const{first:e,lastBid:a,data:d,initials:n,addBid:t,addScore:r,newGame:i}=ee();let l=d.length-1;((m=d[l])==null?void 0:m.score1)===void 0&&(l-=1);const x=(((b=d[l])==null?void 0:b.score1)||0)-(((u=d[l])==null?void 0:u.score2)||0),o=x>0?Math.floor(x/10):Math.ceil(x/10);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex-container",children:[s.jsx(R,{variant:"h2",component:"h1",children:"♠️ Scores"}),s.jsx(J,{})]}),(((h=d[d.length-1])==null?void 0:h.score1)||0)>=100||(((j=d[d.length-1])==null?void 0:j.score2)||0)>=100?s.jsx(K,{fullWidth:!0,color:"error",onClick:i,variant:"contained",sx:{marginTop:2},children:"Reset"}):s.jsx(Z,{blindTrade:o,first:e,initials:n,lastBid:a,onBidSave:t,onScoreSave:r}),s.jsx(p,{initials:n,data:d})]})});se.displayName="Spades";export{se as default};
//# sourceMappingURL=index-C3ewi9Rh.js.map
