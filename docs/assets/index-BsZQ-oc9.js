import{Q as be,j as t,r as C,P as V,G as ge,D as je}from"./index-_gaDpR0N.js";import{I as _}from"./InfoPopup-QA6irOAS.js";import{A as U}from"./Add-O7vWalve.js";import{R as Y}from"./Remove-B_NOA923.js";import{b as I,c as B,T as Z,a as ee}from"./TableRow-B415UWXi.js";import{I as z,S as Q,T as F}from"./Header-Cukbtikc.js";import{T as se}from"./TableHead-D0nUq0sV.js";import{G as P}from"./Grid-BX8OmUhS.js";import{B as O}from"./Button-CNv2Lst2.js";import{H as te,a as ae}from"./highcharts-react.min-CXb9Gj4w.js";import{C as G}from"./Chip-De15F_3N.js";import{A as H}from"./Avatar-DuIKdcVa.js";import{p as fe,P as ue}from"./PlayerMenu-BnmmyrGe.js";import"./DialogTitle-D5qnBLjI.js";import"./useThemeProps-BEfIgJdc.js";import"./isMuiElement-CwroerCN.js";import"./Select-oy0fNczQ.js";import"./useSlotProps-ClqJ0NWn.js";import"./TextField-DGB_RX0H.js";const R=0,E=13,g={bid:3,blind:!1,train:!1},Be={data:[],first:0,lastBid:[g,g,g,g],lifeBags:[0,0,0,0,0],missedBids:[0,0,0,0],wins1:0,wins2:0,total1:0,total2:0,nils:[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},ne=be("spadesAtom",Be),D=({id:e,blindTrade:s,canTrain:d,bid:a,blind:n,train:o,onBid:r})=>{const c=()=>r(Math.max(a-1,R),!1,!1),m=()=>r(Math.min(a+1,E),!1,!1),x=(j,u)=>r(a,u,!1),h=(j,u)=>r(a,!1,u);return t.jsxs(I,{children:[t.jsx(B,{children:e}),t.jsxs(B,{align:"center",children:[t.jsx(z,{onClick:c,disabled:a<=R,children:t.jsx(Y,{})}),a,t.jsx(z,{onClick:m,disabled:a>=E,children:t.jsx(U,{})})]}),t.jsxs(B,{align:"right",children:[t.jsx(Q,{checked:n,slotProps:{input:{"aria-label":`P${e} Blind Nil`}},onChange:x,size:"small"}),s||n?s:""]}),t.jsx(B,{align:"right",children:d?t.jsx(Q,{checked:o,slotProps:{input:{"aria-label":`P${e} Trains`}},onChange:h,size:"small"}):null})]})},W=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,Se=({blindTrade:e,first:s,initials:d,onBidSave:a})=>{const[n,o]=C.useState([g,g,g,g]),r=(s+0)%4,c=(s+1)%4,m=(s+2)%4,x=(s+3)%4,h=S=>(w,p,M)=>{let y={bid:w,blind:p,train:M};if(p)y={bid:0,blind:p,train:!1};else if(M){let l=10;switch(S){case r:l-=n[m].bid;break;case c:l-=n[x].bid;break;case m:l-=n[r].bid;break;case x:default:l-=n[c].bid}y={bid:l,blind:!1,train:M}}else y={bid:w,blind:!1,train:!1};const i=[...n];i[S]=y,o(i)},j=()=>{a(n),o([g,g,g,g])},u=n.reduce((S,w)=>S-w.bid,13);return t.jsx(_,{title:"+ Bid",onSave:j,children:t.jsxs(Z,{"aria-label":"Bid Table",padding:"none",children:[t.jsx(se,{children:t.jsxs(I,{children:[t.jsx(B,{width:"20%",children:"P"}),t.jsxs(B,{width:"40%",align:"center",children:["Bid (",u," 💰)"]}),t.jsx(B,{width:"20%",align:"center",children:"🦮"}),t.jsx(B,{width:"20%",align:"center",children:"🚂"})]})}),t.jsxs(ee,{children:[t.jsx(D,{id:d[r]+" 🥇",...n[r],onBid:h(r),blindTrade:W(e,r)}),t.jsx(D,{id:d[c],...n[c],onBid:h(c),blindTrade:W(e,c)}),t.jsx(D,{canTrain:0<n[r].bid&&n[r].bid<10,id:d[m],...n[m],blindTrade:W(e,m),onBid:h(m)}),t.jsx(D,{canTrain:0<n[c].bid&&n[c].bid<10,id:d[x]+" 🃏",...n[x],blindTrade:W(e,x),onBid:h(x)})]})]})})},ye=({initials:e,onPenalty:s})=>t.jsx(_,{title:"Penalty",buttonVariant:"outlined",buttonColor:"error",children:t.jsxs(P,{container:!0,spacing:2,children:[t.jsx(P,{size:6,children:t.jsxs(O,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),t.jsx(P,{size:6,children:t.jsxs(O,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),$=({initial:e,lastBid:s,made:d,setMade:a})=>{const n=()=>a(Math.max(d-1,R)),o=()=>a(Math.min(d+1,E));return t.jsxs(P,{size:6,children:[t.jsxs(F,{children:[e," Bid: ",s]}),t.jsxs("div",{children:["Made:",t.jsx(z,{onClick:n,disabled:d<=R,children:t.jsx(Y,{"aria-label":"decrease"})}),d,t.jsx(z,{onClick:o,disabled:d>=E,children:t.jsx(U,{"aria-label":"increase"})})]})]})},pe=({initials:e,lastBid:s,onScoreSave:d})=>{const[a,n]=C.useState(3),[o,r]=C.useState(3),[c,m]=C.useState(3),[x,h]=C.useState(3),j=a+o+c+x,S=j===13?()=>{d([a,o,c,x]),n(3),r(3),m(3),h(3)}:void 0;return t.jsxs(_,{title:"+ Score",onSave:S,children:[t.jsxs(F,{color:j===13?"success":"warning",align:"center",marginBottom:1,children:[j!==13&&"⚠️"," Tricks: ",j]}),t.jsxs(P,{container:!0,spacing:2,children:[t.jsx($,{initial:e[0],lastBid:s[0].bid,made:a,setMade:n}),t.jsx($,{initial:e[1],lastBid:s[1].bid,made:o,setMade:r}),t.jsx($,{initial:e[2],lastBid:s[2].bid,made:c,setMade:m}),t.jsx($,{initial:e[3],lastBid:s[3].bid,made:x,setMade:h})]})]})},de=C.memo(({initials:e,lifeBags:s,missedBids:d,color:a})=>{const n=Math.round(s[s.length-1]),o={accessibility:{enabled:!0},chart:{zooming:{type:"xy"},height:340,backgroundColor:null},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{column:{pointPadding:0},series:{marker:{enabled:!1},lineWidth:2}},title:{text:"Bags",style:{color:a}},tooltip:{shared:!0},xAxis:{crosshair:!0,categories:e.split(""),lineColor:a,labels:{style:{color:a}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:a,labels:{style:{color:a}}},series:[{name:"💰",type:"column",data:s.slice(0,-1)},{name:"🎰",type:"column",data:d},{name:"✅",type:"spline",data:[n,n,n,n],color:a,lineWidth:5}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(te,{highcharts:ae,options:o})})});de.displayName="StatsBagsChart";const X=e=>e.reduce((s,d)=>d.train?s+"🚂":d.blind?s+"🦮":d.bid===0?s+"🚫":d.bid>=10?s+`,${d.bid},`:s+d.bid.toString(),""),q=(e,s,d,a)=>{let n=0,o=0,r="";if(e.blind&&s.blind)e.made===0&&s.made===0?n=80:(o=e.made+s.made,r="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?n=60:e.blind&&e.made===0||s.blind&&s.made===0?(n=30,o=e.made+s.made,r="🚫"):e.made===0||s.made===0?(o=e.made+s.made,r="🚫"):(n=-30,o=e.made+s.made,r="🚫🚫"):e.made===0&&s.made===0?n=40:e.made===0||s.made===0?(o=e.made+s.made,r="🚫"):(n=-20,o=e.made+s.made,r="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(n=20,o=e.made+s.made-10):(n=-20,r="🚂");else{e.bid===0?e.made===0?n+=e.blind?20:10:(n-=10,o+=e.made,r="🚫"):s.bid===0&&(s.made===0?n+=s.blind?20:10:(n-=10,o+=s.made,r="🚫"));const c=e.bid+s.bid,m=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);m>=c?(n+=c,o+=m-c):(n-=c,r+="🎰")}for(;a+o>=10;)n-=9,o-=10,r+="💰";return{score:d+n,bags:a+o,mod:r}},J=(e,s,d)=>{let a=s+3,n=(d||"")+"😈",o=e;return a>=10&&(o-=9,a-=10,n+="💰"),{score:o,bags:a,mod:n}},L=(e,s)=>e===s?"default":e>s?"success":"error",we=(e,s,d,a,n,o)=>{const r=[...e],c=[...o],m=[...s],x=d,h=(d+1)%4,j=(d+2)%4,u=(d+3)%4,S=a[j].bid===0&&!a[j].blind,w=a[u].bid===0&&!a[u].blind,p=a[x].bid+a[j].bid>n[x]+n[j],M=a[h].bid+a[u].bid>n[h]+n[u];return a.forEach((y,i)=>{r[i][0]+=y.bid===0?1:0,r[i][1]+=y.blind?1:0,r[i][2]+=y.bid===0&&n[i]===0?1:0;const l=(i+2)%4,b=y.bid+a[l].bid-(n[i]+n[l]),f=y.bid-n[i];y.bid>2&&b>0&&f>0&&(c[i]+=Math.min(f,b)),!(i===x&&S||i===h&&w||((i===x||i===j)&&M||(i===h||i===u)&&p)||y.train||a[l].train)&&-b>0&&-f>0&&(m[i]+=Math.min(-f,-b))}),m[a.length]+=.25,{newNils:r,newMissedBids:c,newLifeBags:m}},oe=C.memo(({color:e,initials:s,nils:d})=>{const a={accessibility:{enabled:!0},chart:{type:"column",height:340,backgroundColor:null},credits:{enabled:!1},legend:{padding:0,itemStyle:{color:e}},plotOptions:{column:{stacking:"normal",pointPadding:0}},title:{text:"Nils",style:{color:e}},xAxis:{categories:s.split(""),lineColor:e,labels:{style:{color:e}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:e,labels:{style:{color:e}}},series:[{name:"🚫",data:d.map(n=>n[0]-n[1]),stack:"Nils"},{name:"🦮",data:d.map(n=>n[1]),stack:"Nils"},{name:"🏅",data:d.map(n=>n[2]),stack:"Wins"}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(te,{highcharts:ae,options:a})})});oe.displayName="StatsNilChart";const ve=({initials:e})=>{const s=V(ge),{total1:d,total2:a,nils:n,lifeBags:o,missedBids:r}=V(ne),c=s.mode==="light"?"black":"white";return t.jsx(_,{title:"Stats",buttonVariant:"outlined",buttonColor:"success",children:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex-container",style:{paddingBottom:15},children:[t.jsx(F,{children:"Totals:"}),t.jsx(G,{avatar:t.jsx(H,{children:e[0]+e[2]}),color:L(d,a),label:d}),t.jsx(G,{avatar:t.jsx(H,{children:e[1]+e[3]}),color:L(a,d),label:a})]}),t.jsx(de,{color:c,initials:e,lifeBags:o,missedBids:r}),t.jsx(oe,{color:c,initials:e,nils:n})]})})},Me=({blindTrade:e,first:s,initials:d,lastBid:a,showPenalty:n,onBidSave:o,onPenalty:r,onScoreSave:c})=>t.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[t.jsx(Se,{blindTrade:e,first:s,initials:d,onBidSave:o}),n&&t.jsx(ye,{initials:d,onPenalty:r}),t.jsx(ve,{initials:d}),t.jsx(pe,{initials:d,lastBid:a,onScoreSave:c})]}),K=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,Ce=({initials:e,data:s})=>t.jsxs(Z,{"aria-label":"Bid Table",children:[t.jsx(se,{children:t.jsxs(I,{children:[t.jsx(B,{width:"10%",children:"🥇"}),t.jsxs(B,{children:["Bid",t.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),t.jsx(B,{children:e[0]+e[2]}),t.jsx(B,{children:e[1]+e[3]})]})}),t.jsx(ee,{children:s.map((d,a)=>t.jsxs(I,{children:[t.jsxs(B,{padding:a===s.length-1?"none":void 0,align:"center",children:[d.start,a===s.length-1&&(d.score1?"🃏":"🥇")]}),t.jsx(B,{children:d.bid}),t.jsxs(B,{children:[K(d.score1,d.score2),d.bags1,d.mod1&&` (${d.mod1})`]}),t.jsxs(B,{children:[K(d.score2,d.score1),d.bags2,d.mod2&&` (${d.mod2})`]})]},a))})]}),Ae=()=>{const e=V(fe),[s,d]=je(ne),{data:a,first:n,lastBid:o,lifeBags:r,missedBids:c,wins1:m,wins2:x,total1:h,total2:j,nils:u}=s,S=e.reduce((i,l,b)=>b<4?i+l.name[0]:i,"");return{data:a,first:n,initials:S,lastBid:o,lifeBags:r,wins1:m,wins2:x,addBid:i=>{const l=a.length-1;if(a[l]&&a[l]?.score1===void 0){const f=[...a];f[l].bid=X(i),d({...s,data:f,lastBid:i});return}const b=[...a];b.push({start:S[n],bid:X(i)}),d({...s,data:b,lastBid:i})},addPenalty:i=>()=>{let l=a.length-1;if(a[l]?.score1===void 0&&(l-=1),i===0){const{score1:b,bags1:f,mod1:v}=a[l]||{};if(b===void 0||f===void 0)return;const{score:T,bags:k,mod:N}=J(b,f,v),A=[...a];A[l]={...a[l],score1:T,bags1:k,mod1:N},d({...s,data:A})}else{const{score2:b,bags2:f,mod2:v}=a[l]||{};if(b===void 0||f===void 0)return;const{score:T,bags:k,mod:N}=J(b,f,v),A=[...a];A[l]={...a[l],score2:T,bags2:k,mod2:N},d({...s,data:A})}},addScore:i=>{const l=a.length-1;if(a[l]?.score1!==void 0)return;const b=[...a],{score1:f,bags1:v,score2:T,bags2:k}=a[l-1]||{},{score:N,bags:A,mod:re}=q({...o[0],made:i[0]},{...o[2],made:i[2]},f||0,v||0),{score:ie,bags:le,mod:ce}=q({...o[1],made:i[1]},{...o[3],made:i[3]},T||0,k||0);b[l]={...a[l],score1:N,bags1:A,mod1:re,score2:ie,bags2:le,mod2:ce};const{newNils:me,newMissedBids:he,newLifeBags:xe}=we(u,r,n,o,i,c);d({...s,data:b,first:(n+1)%4,lastBid:[g,g,g,g],lifeBags:xe,missedBids:he,nils:me})},newGame:()=>{const{score1:i,bags1:l,score2:b,bags2:f}=a[a.length-1],v=i===b&&(l||0)>(f||0)||(i||0)>(b||0);d({...s,data:[],lastBid:[g,g,g,g],wins1:m+(v?1:0),wins2:x+(v?0:1),total1:h+(i||0)*10+(l||0),total2:j+(b||0)*10+(f||0)})}}},Te=({initials:e,wins1:s,wins2:d})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex-container",children:[t.jsx(F,{variant:"h2",component:"h1",children:"♠️🧮"}),t.jsx(G,{avatar:t.jsx(H,{children:e[0]+e[2]}),color:L(s,d),label:s}),t.jsx(G,{avatar:t.jsx(H,{children:e[1]+e[3]}),color:L(d,s),label:d}),t.jsx(ue,{})]})}),ke=C.memo(()=>{const{data:e,initials:s,wins1:d,wins2:a,newGame:n,first:o,lastBid:r,addBid:c,addPenalty:m,addScore:x}=Ae();let h=e.length-1;e[h]?.score1===void 0&&(h-=1);const j=e[h]?.score1||0,u=e[h]?.bags1||0,S=e[h]?.score2||0,w=e[h]?.bags2||0,p=j*10+u-(S*10+w),M=p>0?Math.floor(p/100):Math.ceil(p/100);return t.jsxs(t.Fragment,{children:[t.jsx(Te,{initials:s,wins1:d,wins2:a}),j>=100||S>=100?t.jsx(O,{fullWidth:!0,color:"error",onClick:n,variant:"contained",sx:{marginTop:2},children:"Reset"}):t.jsx(Me,{blindTrade:M,first:o,initials:s,lastBid:r,showPenalty:e[0]?.score1!==void 0,onBidSave:c,onPenalty:m,onScoreSave:x}),t.jsx(Ce,{initials:s,data:e})]})});ke.displayName="Spades";export{ke as default};
//# sourceMappingURL=index-BsZQ-oc9.js.map
