import{Q as ae,j as a,r as $,P as de,B as ne}from"./index-BNQyLwbZ.js";import{I as H}from"./InfoPopup-Bvi86THm.js";import{A as K}from"./Add-CRRImDC9.js";import{R as L}from"./Remove-C32URNvV.js";import{b as N,c as u,T as U,a as Y}from"./TableRow-DWn7llLd.js";import{I as z,S as V,T as F}from"./Header-DIsRcvtB.js";import{T as Z}from"./TableHead-CJQOpwdX.js";import{G as k}from"./Grid2-CeTvW4IJ.js";import{B as E}from"./Button-GAzBZ-eY.js";import{p as re,P as te}from"./PlayerMenu-Bt1cCR57.js";import{C as W}from"./Chip-B62aT7A2.js";import{A as _}from"./Avatar-CicASJBp.js";import"./DialogTitle-d1vy0FiU.js";import"./useThemeProps-B-oDIA_i.js";import"./isMuiElement-CDD4chH5.js";import"./Select-DWppGXj2.js";import"./useSlotProps-Czv7_Ha2.js";import"./TextField-BuOFhm2V.js";const G=0,R=13,h={bid:3,blind:!1,train:!1},oe={data:[],first:0,lastBid:[h,h,h,h],overBids:[0,0,0,0],wins1:0,wins2:0},ie=ae("spadesAtom",oe),C=({id:e,blindTrade:s,canTrain:n,bid:d,blind:r,train:t,onBid:o})=>{const i=()=>o(Math.max(d-1,G),!1,!1),x=()=>o(Math.min(d+1,R),!1,!1),j=(b,v)=>o(d,v,!1),S=(b,v)=>o(d,!1,v);return a.jsxs(N,{children:[a.jsx(u,{children:e}),a.jsxs(u,{align:"center",children:[a.jsx(z,{onClick:i,disabled:d<=G,children:a.jsx(L,{})}),d,a.jsx(z,{onClick:x,disabled:d>=R,children:a.jsx(K,{})})]}),a.jsxs(u,{align:"right",children:[a.jsx(V,{checked:r,inputProps:{"aria-label":`P${e} Blind Nil`},onChange:j,size:"small"}),s||r?s:""]}),a.jsx(u,{align:"right",children:n?a.jsx(V,{checked:t,inputProps:{"aria-label":`P${e} Trains`},onChange:S,size:"small"}):null})]})},I=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,ce=({blindTrade:e,first:s,initials:n,onBidSave:d})=>{const[r,t]=$.useState([h,h,h,h]),o=(s+0)%4,i=(s+1)%4,x=(s+2)%4,j=(s+3)%4,S=M=>(c,l,m)=>{let f={bid:c,blind:l,train:m};if(l)f={bid:0,blind:l,train:!1};else if(m){let B=10;switch(M){case o:B-=r[x].bid;break;case i:B-=r[j].bid;break;case x:B-=r[o].bid;break;case j:default:B-=r[i].bid}f={bid:B,blind:!1,train:m}}else f={bid:c,blind:!1,train:!1};const g=[...r];g[M]=f,t(g)},b=()=>{d(r),t([h,h,h,h])},v=r.reduce((M,c)=>M-c.bid,13);return a.jsx(H,{title:"+ Bid",onSave:b,children:a.jsxs(U,{"aria-label":"Bid Table",padding:"none",children:[a.jsx(Z,{children:a.jsxs(N,{children:[a.jsx(u,{width:"20%",children:"P"}),a.jsxs(u,{width:"40%",align:"center",children:["Bid (",v," 💰)"]}),a.jsx(u,{width:"20%",align:"center",children:"🦮"}),a.jsx(u,{width:"20%",align:"center",children:"🚂"})]})}),a.jsxs(Y,{children:[a.jsx(C,{id:n[o]+" 🥇",...r[o],onBid:S(o),blindTrade:I(e,o)}),a.jsx(C,{id:n[i],...r[i],onBid:S(i),blindTrade:I(e,i)}),a.jsx(C,{canTrain:0<r[o].bid&&r[o].bid<10,id:n[x],...r[x],blindTrade:I(e,x),onBid:S(x)}),a.jsx(C,{canTrain:0<r[i].bid&&r[i].bid<10,id:n[j]+" 🃏",...r[j],blindTrade:I(e,j),onBid:S(j)})]})]})})},le=({initials:e,onPenalty:s})=>a.jsx(H,{title:"Penalty",children:a.jsxs(k,{container:!0,spacing:2,children:[a.jsx(k,{size:6,children:a.jsxs(E,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),a.jsx(k,{size:6,children:a.jsxs(E,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),D=({initial:e,lastBid:s,made:n,setMade:d})=>{const r=()=>d(Math.max(n-1,G)),t=()=>d(Math.min(n+1,R));return a.jsxs(k,{size:6,children:[a.jsxs(F,{children:[e," Bid: ",s]}),a.jsxs("div",{children:["Made:",a.jsx(z,{onClick:r,disabled:n<=G,children:a.jsx(L,{})}),n,a.jsx(z,{onClick:t,disabled:n>=R,children:a.jsx(K,{})})]})]})},me=({initials:e,lastBid:s,onScoreSave:n})=>{const[d,r]=$.useState(3),[t,o]=$.useState(3),[i,x]=$.useState(3),[j,S]=$.useState(3),b=d+t+i+j,M=b===13?()=>{n([d,t,i,j]),r(3),o(3),x(3),S(3)}:void 0;return a.jsxs(H,{title:"+ Score",onSave:M,children:[a.jsxs(F,{color:b===13?"success":"warning",align:"center",marginBottom:1,children:[b!==13&&"⚠️"," Tricks: ",b]}),a.jsxs(k,{container:!0,spacing:2,children:[a.jsx(D,{initial:e[0],lastBid:s[0].bid,made:d,setMade:r}),a.jsx(D,{initial:e[1],lastBid:s[1].bid,made:t,setMade:o}),a.jsx(D,{initial:e[2],lastBid:s[2].bid,made:i,setMade:x}),a.jsx(D,{initial:e[3],lastBid:s[3].bid,made:j,setMade:S})]})]})},he=({blindTrade:e,first:s,initials:n,lastBid:d,showPenalty:r,onBidSave:t,onPenalty:o,onScoreSave:i})=>a.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[a.jsx(ce,{blindTrade:e,first:s,initials:n,onBidSave:t}),r&&a.jsx(le,{initials:n,onPenalty:o}),a.jsx(me,{initials:n,lastBid:d,onScoreSave:i})]}),X=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,xe=({initials:e,data:s})=>a.jsxs(U,{"aria-label":"Bid Table",children:[a.jsx(Z,{children:a.jsxs(N,{children:[a.jsx(u,{width:"10%",children:"🥇"}),a.jsxs(u,{children:["Bid",a.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),a.jsx(u,{children:e[0]+e[2]}),a.jsx(u,{children:e[1]+e[3]})]})}),a.jsx(Y,{children:s.map((n,d)=>a.jsxs(N,{children:[a.jsxs(u,{padding:d===s.length-1?"none":void 0,align:"center",children:[n.start,d===s.length-1&&(n.score1?"🃏":"🥇")]}),a.jsx(u,{children:n.bid}),a.jsxs(u,{children:[X(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),a.jsxs(u,{children:[X(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},d))})]}),je=e=>e.reduce((s,n)=>n.train?s+"🚂":n.blind?s+"🦮":n.bid===0?s+"🚫":n.bid>=10?s+`,${n.bid},`:s+n.bid.toString(),""),q=(e,s,n,d)=>{let r=0,t=0,o="";if(e.blind&&s.blind)e.made===0&&s.made===0?r=80:(t=e.made+s.made,o="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?r=60:e.blind&&e.made===0||s.blind&&s.made===0?(r=30,t=e.made+s.made,o="🚫"):e.made===0||s.made===0?(t=e.made+s.made,o="🚫"):(r=-30,t=e.made+s.made,o="🚫🚫"):e.made===0&&s.made===0?r=40:e.made===0||s.made===0?(t=e.made+s.made,o="🚫"):(r=-20,t=e.made+s.made,o="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(r=20,t=e.made+s.made-10):(r=-20,o="🚂");else{e.bid===0?e.made===0?r+=e.blind?20:10:(r-=10,t+=e.made,o="🚫"):s.bid===0&&(s.made===0?r+=s.blind?20:10:(r-=10,t+=s.made,o="🚫"));const i=e.bid+s.bid,x=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);x>=i?(r+=i,t+=x-i):(r-=i,o+="🎰")}for(;d+t>=10;)r-=9,t-=10,o+="💰";return{score:n+r,bags:d+t,mod:o}},J=(e,s,n)=>{let d=s+3,r=(n||"")+"😈",t=e;return d>=10&&(t-=9,d-=10,r+="💰"),{score:t,bags:d,mod:r}},be=()=>{const e=de(re),[s,n]=ne(ie),{data:d,first:r,lastBid:t,overBids:o,wins1:i,wins2:x}=s,j=e.reduce((c,l,m)=>m<4?c+l.name[0]:c,"");return{data:d,first:r,initials:j,lastBid:t,overBids:o,wins1:i,wins2:x,addBid:c=>{var m;if(d[d.length-1]&&((m=d[d.length-1])==null?void 0:m.score1)===void 0)return;const l=[...d];l.push({start:j[r],bid:je(c)}),n({...s,data:l,lastBid:c})},addPenalty:c=>()=>{var m;let l=d.length-1;if(((m=d[l])==null?void 0:m.score1)===void 0&&(l-=1),c===0){const{score1:f,bags1:g,mod1:B}=d[l]||{};if(f===void 0||g===void 0)return;const{score:y,bags:T,mod:A}=J(f,g,B),w=[...d];w[l]={...d[l],score1:y,bags1:T,mod1:A},n({...s,data:w})}else{const{score2:f,bags2:g,mod2:B}=d[l]||{};if(f===void 0||g===void 0)return;const{score:y,bags:T,mod:A}=J(f,g,B),w=[...d];w[l]={...d[l],score2:y,bags2:T,mod2:A},n({...s,data:w})}},addScore:c=>{var Q;if(((Q=d[d.length-1])==null?void 0:Q.score1)!==void 0)return;const l=[...d],{score1:m,bags1:f,score2:g,bags2:B}=d[d.length-2]||{},{score:y,bags:T,mod:A}=q({...t[0],made:c[0]},{...t[2],made:c[2]},m||0,f||0),{score:w,bags:p,mod:ee}=q({...t[1],made:c[1]},{...t[3],made:c[3]},g||0,B||0);l[d.length-1]={...d[d.length-1],score1:y,bags1:T,mod1:A,score2:w,bags2:p,mod2:ee};const O=[0,0,0,0];t.forEach((se,P)=>{P===0&&t[2].bid===0||P===1&&t[3].bid===0||(O[P]+=Math.min(c[P]-se.bid,P===0||P===2?T||0:p||0))}),n({...s,data:l,first:(r+1)%4,lastBid:[h,h,h,h],overBids:O})},newGame:()=>{const{score1:c,bags1:l}=d[d.length-1],{score2:m,bags2:f}=d[d.length-1],g=c===m&&(l||0)>(f||0)||(c||0)>(m||0);n({...s,data:[],lastBid:[h,h,h,h],wins1:i+(g?1:0),wins2:x+(g?0:1)})}}},fe=({initials:e,overBids:s,wins1:n,wins2:d})=>a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex-container",children:[a.jsx(F,{variant:"h2",component:"h1",children:"♠️ 🧮"}),a.jsx(te,{})]}),a.jsx("br",{"aria-hidden":!0}),a.jsxs("div",{className:"flex-container",children:[a.jsx(W,{avatar:a.jsx(_,{children:e[0]+e[2]}),color:n>=d?"success":"error",label:n}),a.jsx(W,{avatar:a.jsx(_,{children:"💰"}),label:`${e[0]} ${s[0]} | ${e[1]} ${s[1]} | ${e[2]} ${s[2]} | ${e[3]} ${s[3]}`}),a.jsx(W,{avatar:a.jsx(_,{children:e[1]+e[3]}),color:d>=n?"success":"error",label:d})]})]}),ge=$.memo(()=>{var g,B,y,T,A,w;const{data:e,initials:s,overBids:n,wins1:d,wins2:r,newGame:t,first:o,lastBid:i,addBid:x,addPenalty:j,addScore:S}=be();let b=e.length-1;((g=e[b])==null?void 0:g.score1)===void 0&&(b-=1);const v=((B=e[b])==null?void 0:B.score1)||0,M=((y=e[b])==null?void 0:y.bags1)||0,c=((T=e[b])==null?void 0:T.score2)||0,l=((A=e[b])==null?void 0:A.bags2)||0,m=v*10+M-(c*10+l),f=m>0?Math.floor(m/100):Math.ceil(m/100);return a.jsxs(a.Fragment,{children:[a.jsx(fe,{initials:s,overBids:n,wins1:d,wins2:r}),v>=100||c>=100?a.jsx(E,{fullWidth:!0,color:"error",onClick:t,variant:"contained",sx:{marginTop:2},children:"Reset"}):a.jsx(he,{blindTrade:f,first:o,initials:s,lastBid:i,showPenalty:((w=e[0])==null?void 0:w.score1)!==void 0,onBidSave:x,onPenalty:j,onScoreSave:S}),a.jsx(xe,{initials:s,data:e})]})});ge.displayName="Spades";export{ge as default};
//# sourceMappingURL=index-hmRQeZER.js.map
