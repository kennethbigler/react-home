import{O as I,P as F,W as H,r as M,A as W,j as y}from"./index-DhVGG_NW.js";import{t as S,G as U,a as P,D as k}from"./GameTable-bTZ39jEv.js";import{p as D,P as $,d as _}from"./PlayerMenu-GYxIq9U-.js";import{T as J}from"./Header-_9woOApa.js";import"./Card-D4Y94udQ.js";import"./Slider-DObyjXDV.js";import"./visuallyHidden-Dan1xhjv.js";import"./Select-CB1fBJ4I.js";import"./isMuiElement-Ck9jPB8g.js";import"./useSlotProps-kF76sogf.js";import"./useId-CPd3QfSM.js";import"./blueGrey-BeTiP1I_.js";import"./Button-Dj3HxRuo.js";import"./Grid2-YuZ42mY6.js";import"./useThemeProps-CYeelXC8.js";import"./TextField-B9k9V_fq.js";const C=(a,t)=>{if(t.includes(4))return 7;const e=t.includes(3),r=t.indexOf(2),n=r!==-1;if(e&&n)return 6;if(e)return 3;if(n&&t.includes(2,r+1))return 2;if(n)return 1;const s=t.lastIndexOf(1)-t.indexOf(1)===4||t[12]&&t[0]&&t[1]&&t[2]&&t[3];let o=!0;for(let d=0;d<a.length;d+=1)if(a[d].suit!==a[0].suit){o=!1;break}return s&&o?8:o?5:s?4:0},E=a=>{const t=[0,0,0,0,0,0,0,0,0,0,0,0,0];return a.forEach(e=>{e&&(t[e.weight-2]+=1)}),t},B=a=>{const t=E(a),e=C(a,t),r=["0","0","0","0","0"];let n=0,s=4,o=0,d=-1;for(;n<5;){const h=t.indexOf(s,d+1);h===-1?(s-=1,d=-1):(r[o]=h.toString(14),o+=1,n+=s,d=h)}return`${e}${r.reduce((h,g)=>`${h}${g}`)}`},x=(a,t,e)=>{const r=[],n=[t.indexOf(1)];for(let s=1;s<a;s+=1)n[s]=t.indexOf(1,n[s-1]+1);for(let s=0;s<e.length;s+=1)for(let o=0;o<n.length;o+=1)if(e[s].weight-2===n[o]){r.push(s);break}return r},V=async(a,t)=>{if(a.hands.length<1)return a;try{const e=a.hands[0].cards,r=E(e);switch(C(e,r)){case 0:{const s=r.lastIndexOf(1)>=11?x(4,r,e):[0,1,2,3,4];return await t(s,a)}case 1:{const s=x(3,r,e);return await t(s,a)}case 2:case 3:{const s=x(1,r,e);return await t(s,a)}case 4:case 5:case 6:case 7:case 8:default:break}}catch(e){console.error(e)}return a},q=a=>{let t={val:0,id:0};a.forEach(e=>{var n;if(((n=e.hands[0])==null?void 0:n.cards.length)<1)return;const r=parseInt(B(e.hands[0].cards),14);r>t.val&&(t={val:r,id:e.id})}),a.forEach((e,r)=>{if(e.id===t.id){const n={...e,status:"win",money:e.money+20};a[r]=n}else{const n={...e,status:"lose",money:e.money-5};a[r]=n}})};var m=(a=>(a.DISCARD_CARDS="Discard Cards",a.END_TURN="End Turn",a.NEW_GAME="New Game",a.START_GAME="Start Game",a))(m||{});const T=()=>({gameFunctions:["Start Game"],cardsToDiscard:[],hideHands:!0,gameOver:!1}),A=I({key:"pokerAtom",default:JSON.parse(localStorage.getItem("poker-atom")||"null")||T(),effects:[({onSet:a})=>{a(t=>{localStorage.setItem("poker-atom",JSON.stringify(t))})}]}),z=F({key:"pokerState",get:({get:a})=>{const t=a(A),e=a(S),r=a(D).slice(0,5);return{poker:t,turn:e,players:r}},set:({get:a,set:t},e)=>{if(!(e instanceof H)){const{poker:r,turn:n,players:s}=e,o=a(D);t(A,r),t(S,n),t(D,[...s,o[5],o[6]])}}}),K=M.memo(()=>{const[{poker:a,turn:t,players:e},r]=W(z),{cardsToDiscard:n,gameFunctions:s,gameOver:o,hideHands:d}=a,h=async(i,c)=>{const{hands:u}=c,l={...c},f=[...u[0].cards];try{const p=await k.deal(i.length);i.forEach((b,j)=>{f[b]=p[j]}),f.sort(k.rankSort);const{weight:w,soft:v}=_(f);l.hands=[{cards:f,weight:w,soft:v}]}catch(p){console.error(p)}return l},g=async()=>{var i;try{if(!d&&!o&&((i=e[t.player])!=null&&i.isBot)){const c=[...e];await P(e,async(u,l)=>{if(t.player<=l){const f=await V(u,h);c[l]=f}}),q(c),r({poker:{cardsToDiscard:n,gameFunctions:[m.NEW_GAME],gameOver:!0,hideHands:d},players:c,turn:{player:0,hand:0}})}}catch(c){console.error(c)}},R=async()=>{await k.shuffle().then(async()=>{const i=[...e];await P(e,async c=>{const u=await k.deal(5);u.sort(k.rankSort);const{weight:l,soft:f}=_(),p=e.findIndex(w=>w.id===c.id);if(p!==-1){const w={...i[p],hands:[{cards:u,weight:l,soft:f}]};i[p]=w}}),r({players:i,turn:t,poker:{cardsToDiscard:n,gameFunctions:[m.DISCARD_CARDS],gameOver:o,hideHands:!1}})}).catch(i=>{console.error(i)})},N=async(i,c,u)=>{try{const l=[...e],f=await h(u,i[c]);l[c]=f,r({poker:{cardsToDiscard:[],gameFunctions:[m.END_TURN],gameOver:o,hideHands:d},turn:t,players:l})}catch(l){console.error(l)}},O=async i=>{try{const c=[];switch(i){case m.DISCARD_CARDS:await N(e,t.player,n);break;case m.END_TURN:r({poker:{cardsToDiscard:[],gameFunctions:[m.DISCARD_CARDS],gameOver:o,hideHands:d},turn:{player:t.player+1,hand:0},players:e});break;case m.NEW_GAME:e.forEach(u=>c.push({...u,status:"",hands:[],bet:5})),r({poker:T(),turn:{player:0,hand:0},players:c});break;case m.START_GAME:await R();break;default:console.error("Unknown Game Function: ",i)}}catch(c){console.error(c)}},G=(i,c,u)=>{const l=[...n],f=l.indexOf(u);f===-1?l.push(u):l.splice(f,1),r({poker:{cardsToDiscard:l,gameFunctions:s,gameOver:o,hideHands:d},turn:t,players:e})};return g().catch(()=>{console.error("check update failed")}),y.jsxs(y.Fragment,{children:[y.jsxs("div",{className:"flex-container",children:[y.jsx(J,{variant:"h2",component:"h1",gutterBottom:!0,children:"5 Card Draw Poker"}),y.jsx($,{})]}),y.jsx(U,{cardClickHandler:G,cardsToDiscard:n,gameFunctions:s,onClick:O,gameOver:o,hideHands:d,isBlackJack:!1,players:e,turn:t})]})});K.displayName="Poker";export{K as default};
//# sourceMappingURL=index-CrLeqyob.js.map
