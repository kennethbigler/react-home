import{Q as Se,j as t,r as M,P as X,G as ve,D as ye}from"./index-D0Z0gtsj.js";import{I as V}from"./InfoPopup-Bs_hiCrh.js";import{A as se}from"./Add-DU9-EdIA.js";import{R as te}from"./Remove-LV2Ges_a.js";import{b as G,c as f,T as ae,a as ne}from"./TableRow-T1sgF7S-.js";import{I as H,S as K,T as L}from"./Header-BqvWzNdd.js";import{T as de}from"./TableHead-BCltsHXJ.js";import{G as N}from"./Grid2-KitdwFby.js";import{B as q}from"./Button-DqCohwKu.js";import{H as re,a as oe}from"./highcharts-react.min-C9_xBi42.js";import{C as R}from"./Chip-CJgYU-85.js";import{A as _}from"./Avatar-r07WMO32.js";import{p as we,P as Ce}from"./PlayerMenu-DPJlmh1o.js";import"./DialogTitle-DMrznzQW.js";import"./useThemeProps-DqYT3NBW.js";import"./isMuiElement-CajjG3oN.js";import"./Select-xniT4aN0.js";import"./useSlotProps-Bd4uDqep.js";import"./TextField-plkxirSE.js";const E=0,F=13,x={bid:3,blind:!1,train:!1},pe={data:[],first:0,lastBid:[x,x,x,x],overBids:[0,0,0,0,0],wins1:0,wins2:0,total1:0,total2:0,nils:[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},le=Se("spadesAtom",pe),$=({id:e,blindTrade:s,canTrain:n,bid:a,blind:d,train:r,onBid:o})=>{const c=()=>o(Math.max(a-1,E),!1,!1),m=()=>o(Math.min(a+1,F),!1,!1),g=(b,S)=>o(a,S,!1),u=(b,S)=>o(a,!1,S);return t.jsxs(G,{children:[t.jsx(f,{children:e}),t.jsxs(f,{align:"center",children:[t.jsx(H,{onClick:c,disabled:a<=E,children:t.jsx(te,{})}),a,t.jsx(H,{onClick:m,disabled:a>=F,children:t.jsx(se,{})})]}),t.jsxs(f,{align:"right",children:[t.jsx(K,{checked:d,slotProps:{input:{"aria-label":`P${e} Blind Nil`}},onChange:g,size:"small"}),s||d?s:""]}),t.jsx(f,{align:"right",children:n?t.jsx(K,{checked:r,slotProps:{input:{"aria-label":`P${e} Trains`}},onChange:u,size:"small"}):null})]})},I=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,Ae=({blindTrade:e,first:s,initials:n,onBidSave:a})=>{const[d,r]=M.useState([x,x,x,x]),o=(s+0)%4,c=(s+1)%4,m=(s+2)%4,g=(s+3)%4,u=y=>(w,k,C)=>{let l={bid:w,blind:k,train:C};if(k)l={bid:0,blind:k,train:!1};else if(C){let h=10;switch(y){case o:h-=d[m].bid;break;case c:h-=d[g].bid;break;case m:h-=d[o].bid;break;case g:default:h-=d[c].bid}l={bid:h,blind:!1,train:C}}else l={bid:w,blind:!1,train:!1};const i=[...d];i[y]=l,r(i)},b=()=>{a(d),r([x,x,x,x])},S=d.reduce((y,w)=>y-w.bid,13);return t.jsx(V,{title:"+ Bid",onSave:b,children:t.jsxs(ae,{"aria-label":"Bid Table",padding:"none",children:[t.jsx(de,{children:t.jsxs(G,{children:[t.jsx(f,{width:"20%",children:"P"}),t.jsxs(f,{width:"40%",align:"center",children:["Bid (",S," 💰)"]}),t.jsx(f,{width:"20%",align:"center",children:"🦮"}),t.jsx(f,{width:"20%",align:"center",children:"🚂"})]})}),t.jsxs(ne,{children:[t.jsx($,{id:n[o]+" 🥇",...d[o],onBid:u(o),blindTrade:I(e,o)}),t.jsx($,{id:n[c],...d[c],onBid:u(c),blindTrade:I(e,c)}),t.jsx($,{canTrain:0<d[o].bid&&d[o].bid<10,id:n[m],...d[m],blindTrade:I(e,m),onBid:u(m)}),t.jsx($,{canTrain:0<d[c].bid&&d[c].bid<10,id:n[g]+" 🃏",...d[g],blindTrade:I(e,g),onBid:u(g)})]})]})})},Me=({initials:e,onPenalty:s})=>t.jsx(V,{title:"Penalty",buttonVariant:"outlined",buttonColor:"error",children:t.jsxs(N,{container:!0,spacing:2,children:[t.jsx(N,{size:6,children:t.jsxs(q,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),t.jsx(N,{size:6,children:t.jsxs(q,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),z=({initial:e,lastBid:s,made:n,setMade:a})=>{const d=()=>a(Math.max(n-1,E)),r=()=>a(Math.min(n+1,F));return t.jsxs(N,{size:6,children:[t.jsxs(L,{children:[e," Bid: ",s]}),t.jsxs("div",{children:["Made:",t.jsx(H,{onClick:d,disabled:n<=E,children:t.jsx(te,{})}),n,t.jsx(H,{onClick:r,disabled:n>=F,children:t.jsx(se,{})})]})]})},Te=({initials:e,lastBid:s,onScoreSave:n})=>{const[a,d]=M.useState(3),[r,o]=M.useState(3),[c,m]=M.useState(3),[g,u]=M.useState(3),b=a+r+c+g,y=b===13?()=>{n([a,r,c,g]),d(3),o(3),m(3),u(3)}:void 0;return t.jsxs(V,{title:"+ Score",onSave:y,children:[t.jsxs(L,{color:b===13?"success":"warning",align:"center",marginBottom:1,children:[b!==13&&"⚠️"," Tricks: ",b]}),t.jsxs(N,{container:!0,spacing:2,children:[t.jsx(z,{initial:e[0],lastBid:s[0].bid,made:a,setMade:d}),t.jsx(z,{initial:e[1],lastBid:s[1].bid,made:r,setMade:o}),t.jsx(z,{initial:e[2],lastBid:s[2].bid,made:c,setMade:m}),t.jsx(z,{initial:e[3],lastBid:s[3].bid,made:g,setMade:u})]})]})},ie=M.memo(({initials:e,overBids:s,color:n})=>{const a=Math.round(s[s.length-1]),d={chart:{zooming:{type:"xy"},height:340,backgroundColor:null},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!1},lineWidth:2}},title:{text:"Bags",style:{color:n}},tooltip:{shared:!0},xAxis:{crosshair:!0,categories:e.split(""),lineColor:n,labels:{style:{color:n}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:n,labels:{style:{color:n}}},series:[{name:"Bids",type:"column",data:s.slice(0,-1)},{name:"Avg",type:"spline",data:[a,a,a,a],color:n,lineWidth:5}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(re,{highcharts:oe,options:d})})});ie.displayName="StatsBagsChart";const U=e=>e.reduce((s,n)=>n.train?s+"🚂":n.blind?s+"🦮":n.bid===0?s+"🚫":n.bid>=10?s+`,${n.bid},`:s+n.bid.toString(),""),Y=(e,s,n,a)=>{let d=0,r=0,o="";if(e.blind&&s.blind)e.made===0&&s.made===0?d=80:(r=e.made+s.made,o="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?d=60:e.blind&&e.made===0||s.blind&&s.made===0?(d=30,r=e.made+s.made,o="🚫"):e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-30,r=e.made+s.made,o="🚫🚫"):e.made===0&&s.made===0?d=40:e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-20,r=e.made+s.made,o="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(d=20,r=e.made+s.made-10):(d=-20,o="🚂");else{e.bid===0?e.made===0?d+=e.blind?20:10:(d-=10,r+=e.made,o="🚫"):s.bid===0&&(s.made===0?d+=s.blind?20:10:(d-=10,r+=s.made,o="🚫"));const m=e.bid+s.bid,g=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);g>=m?(d+=m,r+=g-m):(d-=m,o+="🎰")}const c=r;for(;a+r>=10;)d-=9,r-=10,o+="💰";return{score:n+d,bags:a+r,mod:o,lifeBags:c}},Z=(e,s,n)=>{let a=s+3,d=(n||"")+"😈",r=e;return a>=10&&(r-=9,a-=10,d+="💰"),{score:r,bags:a,mod:d}},O=(e,s)=>e===s?"default":e>s?"success":"error",ce=M.memo(({color:e,initials:s,nils:n})=>{const a={chart:{type:"column",height:340,backgroundColor:null},credits:{enabled:!1},legend:{padding:0,itemStyle:{color:e}},plotOptions:{column:{stacking:"normal",pointPadding:0}},title:{text:"Nils",style:{color:e}},xAxis:{categories:s.split(""),lineColor:e,labels:{style:{color:e}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:e,labels:{style:{color:e}}},series:[{name:"Bid",data:n.map(d=>d[0]-d[1]),stack:"Nils"},{name:"Blind",data:n.map(d=>d[1]),stack:"Nils"},{name:"Won",data:n.map(d=>d[2]),stack:"Wins"}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(re,{highcharts:oe,options:a})})});ce.displayName="StatsNilChart";const ke=({initials:e,overBids:s})=>{const n=X(ve),{total1:a,total2:d,nils:r}=X(le),o=n.mode==="light"?"black":"white";return t.jsx(V,{title:"Stats",buttonVariant:"outlined",buttonColor:"success",children:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex-container",style:{paddingBottom:15},children:[t.jsx(L,{children:"Totals:"}),t.jsx(R,{avatar:t.jsx(_,{children:e[0]+e[2]}),color:O(a,d),label:a}),t.jsx(R,{avatar:t.jsx(_,{children:e[1]+e[3]}),color:O(d,a),label:d})]}),t.jsx(ie,{color:o,initials:e,overBids:s}),t.jsx(ce,{color:o,initials:e,nils:r})]})})},Pe=({blindTrade:e,first:s,initials:n,overBids:a,lastBid:d,showPenalty:r,onBidSave:o,onPenalty:c,onScoreSave:m})=>t.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[t.jsx(Ae,{blindTrade:e,first:s,initials:n,onBidSave:o}),r&&t.jsx(Me,{initials:n,onPenalty:c}),t.jsx(ke,{initials:n,overBids:a}),t.jsx(Te,{initials:n,lastBid:d,onScoreSave:m})]}),ee=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,De=({initials:e,data:s})=>t.jsxs(ae,{"aria-label":"Bid Table",children:[t.jsx(de,{children:t.jsxs(G,{children:[t.jsx(f,{width:"10%",children:"🥇"}),t.jsxs(f,{children:["Bid",t.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),t.jsx(f,{children:e[0]+e[2]}),t.jsx(f,{children:e[1]+e[3]})]})}),t.jsx(ne,{children:s.map((n,a)=>t.jsxs(G,{children:[t.jsxs(f,{padding:a===s.length-1?"none":void 0,align:"center",children:[n.start,a===s.length-1&&(n.score1?"🃏":"🥇")]}),t.jsx(f,{children:n.bid}),t.jsxs(f,{children:[ee(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),t.jsxs(f,{children:[ee(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},a))})]}),Ne=()=>{const e=X(we),[s,n]=ye(le),{data:a,first:d,lastBid:r,overBids:o,wins1:c,wins2:m,total1:g,total2:u,nils:b}=s,S=e.reduce((l,i,h)=>h<4?l+i.name[0]:l,"");return{data:a,first:d,initials:S,lastBid:r,overBids:o,wins1:c,wins2:m,addBid:l=>{var h;if(a[a.length-1]&&((h=a[a.length-1])==null?void 0:h.score1)===void 0){const j=[...a];j[a.length-1].bid=U(l),n({...s,data:j,lastBid:l});return}const i=[...a];i.push({start:S[d],bid:U(l)}),n({...s,data:i,lastBid:l})},addPenalty:l=>()=>{var h;let i=a.length-1;if(((h=a[i])==null?void 0:h.score1)===void 0&&(i-=1),l===0){const{score1:j,bags1:B,mod1:p}=a[i]||{};if(j===void 0||B===void 0)return;const{score:A,bags:P,mod:D}=Z(j,B,p),T=[...a];T[i]={...a[i],score1:A,bags1:P,mod1:D},n({...s,data:T})}else{const{score2:j,bags2:B,mod2:p}=a[i]||{};if(j===void 0||B===void 0)return;const{score:A,bags:P,mod:D}=Z(j,B,p),T=[...a];T[i]={...a[i],score2:A,bags2:P,mod2:D},n({...s,data:T})}},addScore:l=>{var J;if(((J=a[a.length-1])==null?void 0:J.score1)!==void 0)return;const i=[...a],{score1:h,bags1:j,score2:B,bags2:p}=a[a.length-2]||{},{score:A,bags:P,mod:D,lifeBags:T}=Y({...r[0],made:l[0]},{...r[2],made:l[2]},h||0,j||0),{score:me,bags:he,mod:xe,lifeBags:ge}=Y({...r[1],made:l[1]},{...r[3],made:l[3]},B||0,p||0);i[a.length-1]={...a[a.length-1],score1:A,bags1:P,mod1:D,score2:me,bags2:he,mod2:xe};const W=[...b],be=(d+0)%4,je=(d+1)%4,fe=(d+2)%4,ue=(d+3)%4,Q=[...o];r.forEach((Be,v)=>{W[v][0]+=r[v].bid===0?1:0,W[v][1]+=r[v].blind?1:0,W[v][2]+=l[v]===0?1:0,!(v===be&&r[fe].bid===0||v===je&&r[ue].bid===0)&&(Q[v]+=Math.max(Math.min(l[v]-Be.bid,v===0||v===2?T:ge),0))}),Q[r.length]+=.25,n({...s,data:i,first:(d+1)%4,lastBid:[x,x,x,x],overBids:Q,nils:W})},newGame:()=>{const{score1:l,bags1:i}=a[a.length-1],{score2:h,bags2:j}=a[a.length-1],B=l===h&&(i||0)>(j||0)||(l||0)>(h||0);n({...s,data:[],lastBid:[x,x,x,x],wins1:c+(B?1:0),wins2:m+(B?0:1),total1:g+(l||0)*10+(i||0),total2:u+(h||0)*10+(j||0)})}}},We=({initials:e,wins1:s,wins2:n})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex-container",children:[t.jsx(L,{variant:"h2",component:"h1",children:"♠️🧮"}),t.jsx(R,{avatar:t.jsx(_,{children:e[0]+e[2]}),color:O(s,n),label:s}),t.jsx(R,{avatar:t.jsx(_,{children:e[1]+e[3]}),color:O(n,s),label:n}),t.jsx(Ce,{})]})}),$e=M.memo(()=>{var i,h,j,B,p,A;const{data:e,initials:s,overBids:n,wins1:a,wins2:d,newGame:r,first:o,lastBid:c,addBid:m,addPenalty:g,addScore:u}=Ne();let b=e.length-1;((i=e[b])==null?void 0:i.score1)===void 0&&(b-=1);const S=((h=e[b])==null?void 0:h.score1)||0,y=((j=e[b])==null?void 0:j.bags1)||0,w=((B=e[b])==null?void 0:B.score2)||0,k=((p=e[b])==null?void 0:p.bags2)||0,C=S*10+y-(w*10+k),l=C>0?Math.floor(C/100):Math.ceil(C/100);return t.jsxs(t.Fragment,{children:[t.jsx(We,{initials:s,wins1:a,wins2:d}),S>=100||w>=100?t.jsx(q,{fullWidth:!0,color:"error",onClick:r,variant:"contained",sx:{marginTop:2},children:"Reset"}):t.jsx(Pe,{blindTrade:l,first:o,initials:s,overBids:n,lastBid:c,showPenalty:((A=e[0])==null?void 0:A.score1)!==void 0,onBidSave:m,onPenalty:g,onScoreSave:u}),t.jsx(De,{initials:s,data:e})]})});$e.displayName="Spades";export{$e as default};
//# sourceMappingURL=index-D265f9Cd.js.map
