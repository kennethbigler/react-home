import{Q as re,j as t,r as A,P as U,G as oe,D as ie}from"./index-Dfhkglqi.js";import{I as H}from"./InfoPopup-jeVj9iiy.js";import{A as Y}from"./Add-cPr48IYg.js";import{R as Z}from"./Remove-BR4n7Ae5.js";import{b as I,c as u,T as ee,a as se}from"./TableRow-D9C4dnsg.js";import{I as W,S as F,T as _}from"./Header-BCU4WgNm.js";import{T as te}from"./TableHead-BbPefPOn.js";import{G as k}from"./Grid2-CxoxNt7x.js";import{B as R}from"./Button-DkBRJ6n7.js";import{H as le,a as ce}from"./highcharts-react.min-C8Fm0Njz.js";import{p as me,P as he}from"./PlayerMenu-BADgfZDm.js";import{C as O}from"./Chip-CX_YcqVC.js";import{A as L}from"./Avatar-ChhrGqxT.js";import"./DialogTitle-DJa8a-Jo.js";import"./useThemeProps-JycdxBdz.js";import"./isMuiElement-D6c_QvT2.js";import"./Select-jQRSyeCe.js";import"./useSlotProps-B4yIxVbL.js";import"./TextField-BG_lHKY1.js";const z=0,G=13,x={bid:3,blind:!1,train:!1},xe={data:[],first:0,lastBid:[x,x,x,x],overBids:[0,0,0,0,0],wins1:0,wins2:0},be=re("spadesAtom",xe),p=({id:e,blindTrade:s,canTrain:n,bid:a,blind:d,train:r,onBid:o})=>{const i=()=>o(Math.max(a-1,z),!1,!1),m=()=>o(Math.min(a+1,G),!1,!1),g=(j,w)=>o(a,w,!1),S=(j,w)=>o(a,!1,w);return t.jsxs(I,{children:[t.jsx(u,{children:e}),t.jsxs(u,{align:"center",children:[t.jsx(W,{onClick:i,disabled:a<=z,children:t.jsx(Z,{})}),a,t.jsx(W,{onClick:m,disabled:a>=G,children:t.jsx(Y,{})})]}),t.jsxs(u,{align:"right",children:[t.jsx(F,{checked:d,inputProps:{"aria-label":`P${e} Blind Nil`},onChange:g,size:"small"}),s||d?s:""]}),t.jsx(u,{align:"right",children:n?t.jsx(F,{checked:r,inputProps:{"aria-label":`P${e} Trains`},onChange:S,size:"small"}):null})]})},D=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,ge=({blindTrade:e,first:s,initials:n,onBidSave:a})=>{const[d,r]=A.useState([x,x,x,x]),o=(s+0)%4,i=(s+1)%4,m=(s+2)%4,g=(s+3)%4,S=y=>(l,c,h)=>{let b={bid:l,blind:c,train:h};if(c)b={bid:0,blind:c,train:!1};else if(h){let B=10;switch(y){case o:B-=d[m].bid;break;case i:B-=d[g].bid;break;case m:B-=d[o].bid;break;case g:default:B-=d[i].bid}b={bid:B,blind:!1,train:h}}else b={bid:l,blind:!1,train:!1};const f=[...d];f[y]=b,r(f)},j=()=>{a(d),r([x,x,x,x])},w=d.reduce((y,l)=>y-l.bid,13);return t.jsx(H,{title:"+ Bid",onSave:j,children:t.jsxs(ee,{"aria-label":"Bid Table",padding:"none",children:[t.jsx(te,{children:t.jsxs(I,{children:[t.jsx(u,{width:"20%",children:"P"}),t.jsxs(u,{width:"40%",align:"center",children:["Bid (",w," 💰)"]}),t.jsx(u,{width:"20%",align:"center",children:"🦮"}),t.jsx(u,{width:"20%",align:"center",children:"🚂"})]})}),t.jsxs(se,{children:[t.jsx(p,{id:n[o]+" 🥇",...d[o],onBid:S(o),blindTrade:D(e,o)}),t.jsx(p,{id:n[i],...d[i],onBid:S(i),blindTrade:D(e,i)}),t.jsx(p,{canTrain:0<d[o].bid&&d[o].bid<10,id:n[m],...d[m],blindTrade:D(e,m),onBid:S(m)}),t.jsx(p,{canTrain:0<d[i].bid&&d[i].bid<10,id:n[g]+" 🃏",...d[g],blindTrade:D(e,g),onBid:S(g)})]})]})})},je=({initials:e,onPenalty:s})=>t.jsx(H,{title:"Penalty",buttonVariant:"outlined",buttonColor:"error",children:t.jsxs(k,{container:!0,spacing:2,children:[t.jsx(k,{size:6,children:t.jsxs(R,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),t.jsx(k,{size:6,children:t.jsxs(R,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),$=({initial:e,lastBid:s,made:n,setMade:a})=>{const d=()=>a(Math.max(n-1,z)),r=()=>a(Math.min(n+1,G));return t.jsxs(k,{size:6,children:[t.jsxs(_,{children:[e," Bid: ",s]}),t.jsxs("div",{children:["Made:",t.jsx(W,{onClick:d,disabled:n<=z,children:t.jsx(Z,{})}),n,t.jsx(W,{onClick:r,disabled:n>=G,children:t.jsx(Y,{})})]})]})},fe=({initials:e,lastBid:s,onScoreSave:n})=>{const[a,d]=A.useState(3),[r,o]=A.useState(3),[i,m]=A.useState(3),[g,S]=A.useState(3),j=a+r+i+g,y=j===13?()=>{n([a,r,i,g]),d(3),o(3),m(3),S(3)}:void 0;return t.jsxs(H,{title:"+ Score",onSave:y,children:[t.jsxs(_,{color:j===13?"success":"warning",align:"center",marginBottom:1,children:[j!==13&&"⚠️"," Tricks: ",j]}),t.jsxs(k,{container:!0,spacing:2,children:[t.jsx($,{initial:e[0],lastBid:s[0].bid,made:a,setMade:d}),t.jsx($,{initial:e[1],lastBid:s[1].bid,made:r,setMade:o}),t.jsx($,{initial:e[2],lastBid:s[2].bid,made:i,setMade:m}),t.jsx($,{initial:e[3],lastBid:s[3].bid,made:g,setMade:S})]})]})},ae=A.memo(({initials:e,overBids:s,color:n})=>{const a=Math.round(s[s.length-1]),d={chart:{zooming:{type:"xy"},backgroundColor:null},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!1},lineWidth:2}},title:{text:"Bags",style:{color:n}},tooltip:{shared:!0},xAxis:{crosshair:!0,categories:e.split(""),lineColor:n,labels:{style:{color:n}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:n,labels:{style:{color:n}}},series:[{name:"Bids",type:"column",data:s.slice(0,-1)},{name:"Avg",type:"spline",data:[a,a,a,a],color:n,lineWidth:5}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(le,{highcharts:ce,options:d})})});ae.displayName="StatsBagsChart";const ue=({initials:e,overBids:s})=>{const a=U(oe).mode==="light"?"black":"white";return t.jsx(H,{title:"Stats",buttonVariant:"outlined",buttonColor:"success",children:t.jsx(ae,{initials:e,overBids:s,color:a})})},Be=({blindTrade:e,first:s,initials:n,overBids:a,lastBid:d,showPenalty:r,onBidSave:o,onPenalty:i,onScoreSave:m})=>t.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[t.jsx(ge,{blindTrade:e,first:s,initials:n,onBidSave:o}),r&&t.jsx(je,{initials:n,onPenalty:i}),t.jsx(ue,{initials:n,overBids:a}),t.jsx(fe,{initials:n,lastBid:d,onScoreSave:m})]}),Q=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,Se=({initials:e,data:s})=>t.jsxs(ee,{"aria-label":"Bid Table",children:[t.jsx(te,{children:t.jsxs(I,{children:[t.jsx(u,{width:"10%",children:"🥇"}),t.jsxs(u,{children:["Bid",t.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),t.jsx(u,{children:e[0]+e[2]}),t.jsx(u,{children:e[1]+e[3]})]})}),t.jsx(se,{children:s.map((n,a)=>t.jsxs(I,{children:[t.jsxs(u,{padding:a===s.length-1?"none":void 0,align:"center",children:[n.start,a===s.length-1&&(n.score1?"🃏":"🥇")]}),t.jsx(u,{children:n.bid}),t.jsxs(u,{children:[Q(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),t.jsxs(u,{children:[Q(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},a))})]}),X=e=>e.reduce((s,n)=>n.train?s+"🚂":n.blind?s+"🦮":n.bid===0?s+"🚫":n.bid>=10?s+`,${n.bid},`:s+n.bid.toString(),""),q=(e,s,n,a)=>{let d=0,r=0,o="";if(e.blind&&s.blind)e.made===0&&s.made===0?d=80:(r=e.made+s.made,o="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?d=60:e.blind&&e.made===0||s.blind&&s.made===0?(d=30,r=e.made+s.made,o="🚫"):e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-30,r=e.made+s.made,o="🚫🚫"):e.made===0&&s.made===0?d=40:e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-20,r=e.made+s.made,o="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(d=20,r=e.made+s.made-10):(d=-20,o="🚂");else{e.bid===0?e.made===0?d+=e.blind?20:10:(d-=10,r+=e.made,o="🚫"):s.bid===0&&(s.made===0?d+=s.blind?20:10:(d-=10,r+=s.made,o="🚫"));const i=e.bid+s.bid,m=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);m>=i?(d+=i,r+=m-i):(d-=i,o+="🎰")}for(;a+r>=10;)d-=9,r-=10,o+="💰";return{score:n+d,bags:a+r,mod:o}},J=(e,s,n)=>{let a=s+3,d=(n||"")+"😈",r=e;return a>=10&&(r-=9,a-=10,d+="💰"),{score:r,bags:a,mod:d}},we=()=>{const e=U(me),[s,n]=ie(be),{data:a,first:d,lastBid:r,overBids:o,wins1:i,wins2:m}=s,g=e.reduce((l,c,h)=>h<4?l+c.name[0]:l,"");return{data:a,first:d,initials:g,lastBid:r,overBids:o,wins1:i,wins2:m,addBid:l=>{var h;if(a[a.length-1]&&((h=a[a.length-1])==null?void 0:h.score1)===void 0){const b=[...a];b[a.length-1].bid=X(l),n({...s,data:b,lastBid:l});return}const c=[...a];c.push({start:g[d],bid:X(l)}),n({...s,data:c,lastBid:l})},addPenalty:l=>()=>{var h;let c=a.length-1;if(((h=a[c])==null?void 0:h.score1)===void 0&&(c-=1),l===0){const{score1:b,bags1:f,mod1:B}=a[c]||{};if(b===void 0||f===void 0)return;const{score:C,bags:M,mod:T}=J(b,f,B),v=[...a];v[c]={...a[c],score1:C,bags1:M,mod1:T},n({...s,data:v})}else{const{score2:b,bags2:f,mod2:B}=a[c]||{};if(b===void 0||f===void 0)return;const{score:C,bags:M,mod:T}=J(b,f,B),v=[...a];v[c]={...a[c],score2:C,bags2:M,mod2:T},n({...s,data:v})}},addScore:l=>{var V;if(((V=a[a.length-1])==null?void 0:V.score1)!==void 0)return;const c=[...a],{score1:h,bags1:b,score2:f,bags2:B}=a[a.length-2]||{},{score:C,bags:M,mod:T}=q({...r[0],made:l[0]},{...r[2],made:l[2]},h||0,b||0),{score:v,bags:E,mod:ne}=q({...r[1],made:l[1]},{...r[3],made:l[3]},f||0,B||0);c[a.length-1]={...a[a.length-1],score1:C,bags1:M,mod1:T,score2:v,bags2:E,mod2:ne};const N=[...o];r.forEach((de,P)=>{P===0&&r[2].bid===0||P===1&&r[3].bid===0||(N[P]+=Math.max(Math.min(l[P]-de.bid,P===0||P===2?M||0:E||0),0))}),N[r.length]+=.25,n({...s,data:c,first:(d+1)%4,lastBid:[x,x,x,x],overBids:N})},newGame:()=>{const{score1:l,bags1:c}=a[a.length-1],{score2:h,bags2:b}=a[a.length-1],f=l===h&&(c||0)>(b||0)||(l||0)>(h||0);n({...s,data:[],lastBid:[x,x,x,x],wins1:i+(f?1:0),wins2:m+(f?0:1)})}}},K=(e,s)=>e===s?"default":e>s?"success":"error",ve=({initials:e,wins1:s,wins2:n})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex-container",children:[t.jsx(_,{variant:"h2",component:"h1",children:"♠️🧮"}),t.jsx(O,{avatar:t.jsx(L,{children:e[0]+e[2]}),color:K(s,n),label:s}),t.jsx(O,{avatar:t.jsx(L,{children:e[1]+e[3]}),color:K(n,s),label:n}),t.jsx(he,{})]})}),ye=A.memo(()=>{var f,B,C,M,T,v;const{data:e,initials:s,overBids:n,wins1:a,wins2:d,newGame:r,first:o,lastBid:i,addBid:m,addPenalty:g,addScore:S}=we();let j=e.length-1;((f=e[j])==null?void 0:f.score1)===void 0&&(j-=1);const w=((B=e[j])==null?void 0:B.score1)||0,y=((C=e[j])==null?void 0:C.bags1)||0,l=((M=e[j])==null?void 0:M.score2)||0,c=((T=e[j])==null?void 0:T.bags2)||0,h=w*10+y-(l*10+c),b=h>0?Math.floor(h/100):Math.ceil(h/100);return t.jsxs(t.Fragment,{children:[t.jsx(ve,{initials:s,wins1:a,wins2:d}),w>=100||l>=100?t.jsx(R,{fullWidth:!0,color:"error",onClick:r,variant:"contained",sx:{marginTop:2},children:"Reset"}):t.jsx(Be,{blindTrade:b,first:o,initials:s,overBids:n,lastBid:i,showPenalty:((v=e[0])==null?void 0:v.score1)!==void 0,onBidSave:m,onPenalty:g,onScoreSave:S}),t.jsx(Se,{initials:s,data:e})]})});ye.displayName="Spades";export{ye as default};
//# sourceMappingURL=index-BEAbIjGH.js.map
