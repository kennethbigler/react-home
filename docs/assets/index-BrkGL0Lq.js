import{Q as he,j as t,r as T,P as K,G as xe,D as ge}from"./index-CTHmKoRx.js";import{I as H}from"./InfoPopup-Cbe97QxA.js";import{A as U}from"./Add-Cjpx7qsa.js";import{R as Y}from"./Remove-DeaTy0da.js";import{b as $,c as u,T as Z,a as ee}from"./TableRow-CSzr9qjW.js";import{I,S as L,T as _}from"./Header-DNvGFFvK.js";import{T as se}from"./TableHead-BuoW3cUx.js";import{G as k}from"./Grid2-BviemwBr.js";import{B as R}from"./Button-CrImLWE2.js";import{H as be,a as fe}from"./highcharts-react.min--TPDrwoL.js";import{p as je,P as ue}from"./PlayerMenu-SU4_UY1P.js";import{C as V}from"./Chip-Dj_nBbEy.js";import{A as F}from"./Avatar-BBRbXrbm.js";import"./DialogTitle-CiWhJ0MP.js";import"./useThemeProps-BhpZ4NFc.js";import"./isMuiElement-BXS1e86p.js";import"./Select-DLCGbmEb.js";import"./useSlotProps-Bdf8q3nf.js";import"./TextField-CfoU6Pra.js";const z=0,G=13,g={bid:3,blind:!1,train:!1},Be={data:[],first:0,lastBid:[g,g,g,g],overBids:[0,0,0,0,0],wins1:0,wins2:0,totalWon1:0,totalWon2:0,totalLost1:0,totalLost2:0,nils:[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},Se=he("spadesAtom",Be),p=({id:e,blindTrade:s,canTrain:n,bid:a,blind:d,train:r,onBid:o})=>{const c=()=>o(Math.max(a-1,z),!1,!1),m=()=>o(Math.min(a+1,G),!1,!1),h=(f,v)=>o(a,v,!1),S=(f,v)=>o(a,!1,v);return t.jsxs($,{children:[t.jsx(u,{children:e}),t.jsxs(u,{align:"center",children:[t.jsx(I,{onClick:c,disabled:a<=z,children:t.jsx(Y,{})}),a,t.jsx(I,{onClick:m,disabled:a>=G,children:t.jsx(U,{})})]}),t.jsxs(u,{align:"right",children:[t.jsx(L,{checked:d,slotProps:{input:{"aria-label":`P${e} Blind Nil`}},onChange:h,size:"small"}),s||d?s:""]}),t.jsx(u,{align:"right",children:n?t.jsx(L,{checked:r,slotProps:{input:{"aria-label":`P${e} Trains`}},onChange:S,size:"small"}):null})]})},D=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,ve=({blindTrade:e,first:s,initials:n,onBidSave:a})=>{const[d,r]=T.useState([g,g,g,g]),o=(s+0)%4,c=(s+1)%4,m=(s+2)%4,h=(s+3)%4,S=y=>(i,l,x)=>{let b={bid:i,blind:l,train:x};if(l)b={bid:0,blind:l,train:!1};else if(x){let B=10;switch(y){case o:B-=d[m].bid;break;case c:B-=d[h].bid;break;case m:B-=d[o].bid;break;case h:default:B-=d[c].bid}b={bid:B,blind:!1,train:x}}else b={bid:i,blind:!1,train:!1};const j=[...d];j[y]=b,r(j)},f=()=>{a(d),r([g,g,g,g])},v=d.reduce((y,i)=>y-i.bid,13);return t.jsx(H,{title:"+ Bid",onSave:f,children:t.jsxs(Z,{"aria-label":"Bid Table",padding:"none",children:[t.jsx(se,{children:t.jsxs($,{children:[t.jsx(u,{width:"20%",children:"P"}),t.jsxs(u,{width:"40%",align:"center",children:["Bid (",v," 💰)"]}),t.jsx(u,{width:"20%",align:"center",children:"🦮"}),t.jsx(u,{width:"20%",align:"center",children:"🚂"})]})}),t.jsxs(ee,{children:[t.jsx(p,{id:n[o]+" 🥇",...d[o],onBid:S(o),blindTrade:D(e,o)}),t.jsx(p,{id:n[c],...d[c],onBid:S(c),blindTrade:D(e,c)}),t.jsx(p,{canTrain:0<d[o].bid&&d[o].bid<10,id:n[m],...d[m],blindTrade:D(e,m),onBid:S(m)}),t.jsx(p,{canTrain:0<d[c].bid&&d[c].bid<10,id:n[h]+" 🃏",...d[h],blindTrade:D(e,h),onBid:S(h)})]})]})})},we=({initials:e,onPenalty:s})=>t.jsx(H,{title:"Penalty",buttonVariant:"outlined",buttonColor:"error",children:t.jsxs(k,{container:!0,spacing:2,children:[t.jsx(k,{size:6,children:t.jsxs(R,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),t.jsx(k,{size:6,children:t.jsxs(R,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),W=({initial:e,lastBid:s,made:n,setMade:a})=>{const d=()=>a(Math.max(n-1,z)),r=()=>a(Math.min(n+1,G));return t.jsxs(k,{size:6,children:[t.jsxs(_,{children:[e," Bid: ",s]}),t.jsxs("div",{children:["Made:",t.jsx(I,{onClick:d,disabled:n<=z,children:t.jsx(Y,{})}),n,t.jsx(I,{onClick:r,disabled:n>=G,children:t.jsx(U,{})})]})]})},ye=({initials:e,lastBid:s,onScoreSave:n})=>{const[a,d]=T.useState(3),[r,o]=T.useState(3),[c,m]=T.useState(3),[h,S]=T.useState(3),f=a+r+c+h,y=f===13?()=>{n([a,r,c,h]),d(3),o(3),m(3),S(3)}:void 0;return t.jsxs(H,{title:"+ Score",onSave:y,children:[t.jsxs(_,{color:f===13?"success":"warning",align:"center",marginBottom:1,children:[f!==13&&"⚠️"," Tricks: ",f]}),t.jsxs(k,{container:!0,spacing:2,children:[t.jsx(W,{initial:e[0],lastBid:s[0].bid,made:a,setMade:d}),t.jsx(W,{initial:e[1],lastBid:s[1].bid,made:r,setMade:o}),t.jsx(W,{initial:e[2],lastBid:s[2].bid,made:c,setMade:m}),t.jsx(W,{initial:e[3],lastBid:s[3].bid,made:h,setMade:S})]})]})},te=T.memo(({initials:e,overBids:s,color:n})=>{const a=Math.round(s[s.length-1]),d={chart:{zooming:{type:"xy"},backgroundColor:null},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!1},lineWidth:2}},title:{text:"Bags",style:{color:n}},tooltip:{shared:!0},xAxis:{crosshair:!0,categories:e.split(""),lineColor:n,labels:{style:{color:n}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:n,labels:{style:{color:n}}},series:[{name:"Bids",type:"column",data:s.slice(0,-1)},{name:"Avg",type:"spline",data:[a,a,a,a],color:n,lineWidth:5}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(be,{highcharts:fe,options:d})})});te.displayName="StatsBagsChart";const Me=({initials:e,overBids:s})=>{const a=K(xe).mode==="light"?"black":"white";return t.jsx(H,{title:"Stats",buttonVariant:"outlined",buttonColor:"success",children:t.jsx(te,{initials:e,overBids:s,color:a})})},Ae=({blindTrade:e,first:s,initials:n,overBids:a,lastBid:d,showPenalty:r,onBidSave:o,onPenalty:c,onScoreSave:m})=>t.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[t.jsx(ve,{blindTrade:e,first:s,initials:n,onBidSave:o}),r&&t.jsx(we,{initials:n,onPenalty:c}),t.jsx(Me,{initials:n,overBids:a}),t.jsx(ye,{initials:n,lastBid:d,onScoreSave:m})]}),O=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,Ce=({initials:e,data:s})=>t.jsxs(Z,{"aria-label":"Bid Table",children:[t.jsx(se,{children:t.jsxs($,{children:[t.jsx(u,{width:"10%",children:"🥇"}),t.jsxs(u,{children:["Bid",t.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),t.jsx(u,{children:e[0]+e[2]}),t.jsx(u,{children:e[1]+e[3]})]})}),t.jsx(ee,{children:s.map((n,a)=>t.jsxs($,{children:[t.jsxs(u,{padding:a===s.length-1?"none":void 0,align:"center",children:[n.start,a===s.length-1&&(n.score1?"🃏":"🥇")]}),t.jsx(u,{children:n.bid}),t.jsxs(u,{children:[O(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),t.jsxs(u,{children:[O(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},a))})]}),Q=e=>e.reduce((s,n)=>n.train?s+"🚂":n.blind?s+"🦮":n.bid===0?s+"🚫":n.bid>=10?s+`,${n.bid},`:s+n.bid.toString(),""),X=(e,s,n,a)=>{let d=0,r=0,o="";if(e.blind&&s.blind)e.made===0&&s.made===0?d=80:(r=e.made+s.made,o="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?d=60:e.blind&&e.made===0||s.blind&&s.made===0?(d=30,r=e.made+s.made,o="🚫"):e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-30,r=e.made+s.made,o="🚫🚫"):e.made===0&&s.made===0?d=40:e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-20,r=e.made+s.made,o="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(d=20,r=e.made+s.made-10):(d=-20,o="🚂");else{e.bid===0?e.made===0?d+=e.blind?20:10:(d-=10,r+=e.made,o="🚫"):s.bid===0&&(s.made===0?d+=s.blind?20:10:(d-=10,r+=s.made,o="🚫"));const m=e.bid+s.bid,h=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);h>=m?(d+=m,r+=h-m):(d-=m,o+="🎰")}const c=r;for(;a+r>=10;)d-=9,r-=10,o+="💰";return{score:n+d,bags:a+r,mod:o,lifeBags:c}},q=(e,s,n)=>{let a=s+3,d=(n||"")+"😈",r=e;return a>=10&&(r-=9,a-=10,d+="💰"),{score:r,bags:a,mod:d}},Te=()=>{const e=K(je),[s,n]=ge(Se),{data:a,first:d,lastBid:r,overBids:o,wins1:c,wins2:m}=s,h=e.reduce((i,l,x)=>x<4?i+l.name[0]:i,"");return{data:a,first:d,initials:h,lastBid:r,overBids:o,wins1:c,wins2:m,addBid:i=>{var x;if(a[a.length-1]&&((x=a[a.length-1])==null?void 0:x.score1)===void 0){const b=[...a];b[a.length-1].bid=Q(i),n({...s,data:b,lastBid:i});return}const l=[...a];l.push({start:h[d],bid:Q(i)}),n({...s,data:l,lastBid:i})},addPenalty:i=>()=>{var x;let l=a.length-1;if(((x=a[l])==null?void 0:x.score1)===void 0&&(l-=1),i===0){const{score1:b,bags1:j,mod1:B}=a[l]||{};if(b===void 0||j===void 0)return;const{score:M,bags:A,mod:C}=q(b,j,B),w=[...a];w[l]={...a[l],score1:M,bags1:A,mod1:C},n({...s,data:w})}else{const{score2:b,bags2:j,mod2:B}=a[l]||{};if(b===void 0||j===void 0)return;const{score:M,bags:A,mod:C}=q(b,j,B),w=[...a];w[l]={...a[l],score2:M,bags2:A,mod2:C},n({...s,data:w})}},addScore:i=>{var E;if(((E=a[a.length-1])==null?void 0:E.score1)!==void 0)return;const l=[...a],{score1:x,bags1:b,score2:j,bags2:B}=a[a.length-2]||{},{score:M,bags:A,mod:C,lifeBags:w}=X({...r[0],made:i[0]},{...r[2],made:i[2]},x||0,b||0),{score:ae,bags:ne,mod:de,lifeBags:re}=X({...r[1],made:i[1]},{...r[3],made:i[3]},j||0,B||0);l[a.length-1]={...a[a.length-1],score1:M,bags1:A,mod1:C,score2:ae,bags2:ne,mod2:de};const oe=(d+0)%4,ie=(d+1)%4,le=(d+2)%4,ce=(d+3)%4,N=[...o];r.forEach((me,P)=>{P===oe&&r[le].bid===0||P===ie&&r[ce].bid===0||(N[P]+=Math.max(Math.min(i[P]-me.bid,P===0||P===2?w:re),0))}),N[r.length]+=.25,n({...s,data:l,first:(d+1)%4,lastBid:[g,g,g,g],overBids:N})},newGame:()=>{const{score1:i,bags1:l}=a[a.length-1],{score2:x,bags2:b}=a[a.length-1],j=i===x&&(l||0)>(b||0)||(i||0)>(x||0);n({...s,data:[],lastBid:[g,g,g,g],wins1:c+(j?1:0),wins2:m+(j?0:1)})}}},J=(e,s)=>e===s?"default":e>s?"success":"error",Pe=({initials:e,wins1:s,wins2:n})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex-container",children:[t.jsx(_,{variant:"h2",component:"h1",children:"♠️🧮"}),t.jsx(V,{avatar:t.jsx(F,{children:e[0]+e[2]}),color:J(s,n),label:s}),t.jsx(V,{avatar:t.jsx(F,{children:e[1]+e[3]}),color:J(n,s),label:n}),t.jsx(ue,{})]})}),ke=T.memo(()=>{var j,B,M,A,C,w;const{data:e,initials:s,overBids:n,wins1:a,wins2:d,newGame:r,first:o,lastBid:c,addBid:m,addPenalty:h,addScore:S}=Te();let f=e.length-1;((j=e[f])==null?void 0:j.score1)===void 0&&(f-=1);const v=((B=e[f])==null?void 0:B.score1)||0,y=((M=e[f])==null?void 0:M.bags1)||0,i=((A=e[f])==null?void 0:A.score2)||0,l=((C=e[f])==null?void 0:C.bags2)||0,x=v*10+y-(i*10+l),b=x>0?Math.floor(x/100):Math.ceil(x/100);return t.jsxs(t.Fragment,{children:[t.jsx(Pe,{initials:s,wins1:a,wins2:d}),v>=100||i>=100?t.jsx(R,{fullWidth:!0,color:"error",onClick:r,variant:"contained",sx:{marginTop:2},children:"Reset"}):t.jsx(Ae,{blindTrade:b,first:o,initials:s,overBids:n,lastBid:c,showPenalty:((w=e[0])==null?void 0:w.score1)!==void 0,onBidSave:m,onPenalty:h,onScoreSave:S}),t.jsx(Ce,{initials:s,data:e})]})});ke.displayName="Spades";export{ke as default};
//# sourceMappingURL=index-BrkGL0Lq.js.map
