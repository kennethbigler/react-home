import{Q as Se,j as t,r as M,P as U,G as ve,D as ye}from"./index-BKy3QIW6.js";import{I as q}from"./InfoPopup-BsE-_DTT.js";import{A as de}from"./Add-BDEEwJ9k.js";import{R as re}from"./Remove-DoE78GLz.js";import{b as E,c as u,T as oe,a as le}from"./TableRow-C836Kt_S.js";import{I as F,S as ee,T as J}from"./Header-D1vLYJwz.js";import{T as ie}from"./TableHead-C5Ek-43a.js";import{G as $}from"./Grid2-0VanpF_l.js";import{B as Y}from"./Button-CyQP5XPw.js";import{H as ce,a as he}from"./highcharts-react.min-c3ejCGGX.js";import{C as O}from"./Chip-DUn4PSbF.js";import{A as V}from"./Avatar-zMHD-zLZ.js";import{p as we,P as Ce}from"./PlayerMenu-CICJrRFV.js";import"./DialogTitle-Dou9q-7q.js";import"./useThemeProps-D_M5U_wt.js";import"./isMuiElement-C0XK2jF7.js";import"./Select-BBIxDBA4.js";import"./useSlotProps-Bp36eGVg.js";import"./TextField-D2VrgkND.js";const L=0,Q=13,x={bid:3,blind:!1,train:!1},pe={data:[],first:0,lastBid:[x,x,x,x],overBids:[0,0,0,0,0],wins1:0,wins2:0,total1:0,total2:0,nils:[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},me=Se("spadesAtom",pe),H=({id:e,blindTrade:s,canTrain:n,bid:a,blind:d,train:r,onBid:o})=>{const c=()=>o(Math.max(a-1,L),!1,!1),h=()=>o(Math.min(a+1,Q),!1,!1),g=(b,v)=>o(a,v,!1),B=(b,v)=>o(a,!1,v);return t.jsxs(E,{children:[t.jsx(u,{children:e}),t.jsxs(u,{align:"center",children:[t.jsx(F,{onClick:c,disabled:a<=L,children:t.jsx(re,{})}),a,t.jsx(F,{onClick:h,disabled:a>=Q,children:t.jsx(de,{})})]}),t.jsxs(u,{align:"right",children:[t.jsx(ee,{checked:d,slotProps:{input:{"aria-label":`P${e} Blind Nil`}},onChange:g,size:"small"}),s||d?s:""]}),t.jsx(u,{align:"right",children:n?t.jsx(ee,{checked:r,slotProps:{input:{"aria-label":`P${e} Trains`}},onChange:B,size:"small"}):null})]})},R=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,Ae=({blindTrade:e,first:s,initials:n,onBidSave:a})=>{const[d,r]=M.useState([x,x,x,x]),o=(s+0)%4,c=(s+1)%4,h=(s+2)%4,g=(s+3)%4,B=y=>(w,k,C)=>{let l={bid:w,blind:k,train:C};if(k)l={bid:0,blind:k,train:!1};else if(C){let m=10;switch(y){case o:m-=d[h].bid;break;case c:m-=d[g].bid;break;case h:m-=d[o].bid;break;case g:default:m-=d[c].bid}l={bid:m,blind:!1,train:C}}else l={bid:w,blind:!1,train:!1};const i=[...d];i[y]=l,r(i)},b=()=>{a(d),r([x,x,x,x])},v=d.reduce((y,w)=>y-w.bid,13);return t.jsx(q,{title:"+ Bid",onSave:b,children:t.jsxs(oe,{"aria-label":"Bid Table",padding:"none",children:[t.jsx(ie,{children:t.jsxs(E,{children:[t.jsx(u,{width:"20%",children:"P"}),t.jsxs(u,{width:"40%",align:"center",children:["Bid (",v," 💰)"]}),t.jsx(u,{width:"20%",align:"center",children:"🦮"}),t.jsx(u,{width:"20%",align:"center",children:"🚂"})]})}),t.jsxs(le,{children:[t.jsx(H,{id:n[o]+" 🥇",...d[o],onBid:B(o),blindTrade:R(e,o)}),t.jsx(H,{id:n[c],...d[c],onBid:B(c),blindTrade:R(e,c)}),t.jsx(H,{canTrain:0<d[o].bid&&d[o].bid<10,id:n[h],...d[h],blindTrade:R(e,h),onBid:B(h)}),t.jsx(H,{canTrain:0<d[c].bid&&d[c].bid<10,id:n[g]+" 🃏",...d[g],blindTrade:R(e,g),onBid:B(g)})]})]})})},Me=({initials:e,onPenalty:s})=>t.jsx(q,{title:"Penalty",buttonVariant:"outlined",buttonColor:"error",children:t.jsxs($,{container:!0,spacing:2,children:[t.jsx($,{size:6,children:t.jsxs(Y,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),t.jsx($,{size:6,children:t.jsxs(Y,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),_=({initial:e,lastBid:s,made:n,setMade:a})=>{const d=()=>a(Math.max(n-1,L)),r=()=>a(Math.min(n+1,Q));return t.jsxs($,{size:6,children:[t.jsxs(J,{children:[e," Bid: ",s]}),t.jsxs("div",{children:["Made:",t.jsx(F,{onClick:d,disabled:n<=L,children:t.jsx(re,{})}),n,t.jsx(F,{onClick:r,disabled:n>=Q,children:t.jsx(de,{})})]})]})},Te=({initials:e,lastBid:s,onScoreSave:n})=>{const[a,d]=M.useState(3),[r,o]=M.useState(3),[c,h]=M.useState(3),[g,B]=M.useState(3),b=a+r+c+g,y=b===13?()=>{n([a,r,c,g]),d(3),o(3),h(3),B(3)}:void 0;return t.jsxs(q,{title:"+ Score",onSave:y,children:[t.jsxs(J,{color:b===13?"success":"warning",align:"center",marginBottom:1,children:[b!==13&&"⚠️"," Tricks: ",b]}),t.jsxs($,{container:!0,spacing:2,children:[t.jsx(_,{initial:e[0],lastBid:s[0].bid,made:a,setMade:d}),t.jsx(_,{initial:e[1],lastBid:s[1].bid,made:r,setMade:o}),t.jsx(_,{initial:e[2],lastBid:s[2].bid,made:c,setMade:h}),t.jsx(_,{initial:e[3],lastBid:s[3].bid,made:g,setMade:B})]})]})},xe=M.memo(({initials:e,overBids:s,color:n})=>{const a=Math.round(s[s.length-1]),d={chart:{zooming:{type:"xy"},height:340,backgroundColor:null},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!1},lineWidth:2}},title:{text:"Bags",style:{color:n}},tooltip:{shared:!0},xAxis:{crosshair:!0,categories:e.split(""),lineColor:n,labels:{style:{color:n}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:n,labels:{style:{color:n}}},series:[{name:"Bids",type:"column",data:s.slice(0,-1)},{name:"Avg",type:"spline",data:[a,a,a,a],color:n,lineWidth:5}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(ce,{highcharts:he,options:d})})});xe.displayName="StatsBagsChart";const se=e=>e.reduce((s,n)=>n.train?s+"🚂":n.blind?s+"🦮":n.bid===0?s+"🚫":n.bid>=10?s+`,${n.bid},`:s+n.bid.toString(),""),te=(e,s,n,a)=>{let d=0,r=0,o="";if(e.blind&&s.blind)e.made===0&&s.made===0?d=80:(r=e.made+s.made,o="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?d=60:e.blind&&e.made===0||s.blind&&s.made===0?(d=30,r=e.made+s.made,o="🚫"):e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-30,r=e.made+s.made,o="🚫🚫"):e.made===0&&s.made===0?d=40:e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-20,r=e.made+s.made,o="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(d=20,r=e.made+s.made-10):(d=-20,o="🚂");else{e.bid===0?e.made===0?d+=e.blind?20:10:(d-=10,r+=e.made,o="🚫"):s.bid===0&&(s.made===0?d+=s.blind?20:10:(d-=10,r+=s.made,o="🚫"));const h=e.bid+s.bid,g=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);g>=h?(d+=h,r+=g-h):(d-=h,o+="🎰")}const c=r;for(;a+r>=10;)d-=9,r-=10,o+="💰";return{score:n+d,bags:a+r,mod:o,lifeBags:c}},ae=(e,s,n)=>{let a=s+3,d=(n||"")+"😈",r=e;return a>=10&&(r-=9,a-=10,d+="💰"),{score:r,bags:a,mod:d}},X=(e,s)=>e===s?"default":e>s?"success":"error",ge=M.memo(({color:e,initials:s,nils:n})=>{const a={chart:{type:"column",height:340,backgroundColor:null},credits:{enabled:!1},legend:{padding:0,itemStyle:{color:e}},plotOptions:{column:{stacking:"normal",pointPadding:0}},title:{text:"Nils",style:{color:e}},xAxis:{categories:s.split(""),lineColor:e,labels:{style:{color:e}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:e,labels:{style:{color:e}}},series:[{name:"Bid",data:n.map(d=>d[0]-d[1]),stack:"Nils"},{name:"Blind",data:n.map(d=>d[1]),stack:"Nils"},{name:"Won",data:n.map(d=>d[2]),stack:"Wins"}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(ce,{highcharts:he,options:a})})});ge.displayName="StatsNilChart";const ke=({initials:e,overBids:s})=>{const n=U(ve),{total1:a,total2:d,nils:r}=U(me),o=n.mode==="light"?"black":"white";return t.jsx(q,{title:"Stats",buttonVariant:"outlined",buttonColor:"success",children:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex-container",style:{paddingBottom:15},children:[t.jsx(J,{children:"Totals:"}),t.jsx(O,{avatar:t.jsx(V,{children:e[0]+e[2]}),color:X(a,d),label:a}),t.jsx(O,{avatar:t.jsx(V,{children:e[1]+e[3]}),color:X(d,a),label:d})]}),t.jsx(xe,{color:o,initials:e,overBids:s}),t.jsx(ge,{color:o,initials:e,nils:r})]})})},Pe=({blindTrade:e,first:s,initials:n,overBids:a,lastBid:d,showPenalty:r,onBidSave:o,onPenalty:c,onScoreSave:h})=>t.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[t.jsx(Ae,{blindTrade:e,first:s,initials:n,onBidSave:o}),r&&t.jsx(Me,{initials:n,onPenalty:c}),t.jsx(ke,{initials:n,overBids:a}),t.jsx(Te,{initials:n,lastBid:d,onScoreSave:h})]}),ne=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,De=({initials:e,data:s})=>t.jsxs(oe,{"aria-label":"Bid Table",children:[t.jsx(ie,{children:t.jsxs(E,{children:[t.jsx(u,{width:"10%",children:"🥇"}),t.jsxs(u,{children:["Bid",t.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),t.jsx(u,{children:e[0]+e[2]}),t.jsx(u,{children:e[1]+e[3]})]})}),t.jsx(le,{children:s.map((n,a)=>t.jsxs(E,{children:[t.jsxs(u,{padding:a===s.length-1?"none":void 0,align:"center",children:[n.start,a===s.length-1&&(n.score1?"🃏":"🥇")]}),t.jsx(u,{children:n.bid}),t.jsxs(u,{children:[ne(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),t.jsxs(u,{children:[ne(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},a))})]}),Ne=()=>{const e=U(we),[s,n]=ye(me),{data:a,first:d,lastBid:r,overBids:o,wins1:c,wins2:h,total1:g,total2:B,nils:b}=s,v=e.reduce((l,i,m)=>m<4?l+i.name[0]:l,"");return{data:a,first:d,initials:v,lastBid:r,overBids:o,wins1:c,wins2:h,addBid:l=>{var m;if(a[a.length-1]&&((m=a[a.length-1])==null?void 0:m.score1)===void 0){const j=[...a];j[a.length-1].bid=se(l),n({...s,data:j,lastBid:l});return}const i=[...a];i.push({start:v[d],bid:se(l)}),n({...s,data:i,lastBid:l})},addPenalty:l=>()=>{var m;let i=a.length-1;if(((m=a[i])==null?void 0:m.score1)===void 0&&(i-=1),l===0){const{score1:j,bags1:S,mod1:p}=a[i]||{};if(j===void 0||S===void 0)return;const{score:A,bags:P,mod:D}=ae(j,S,p),T=[...a];T[i]={...a[i],score1:A,bags1:P,mod1:D},n({...s,data:T})}else{const{score2:j,bags2:S,mod2:p}=a[i]||{};if(j===void 0||S===void 0)return;const{score:A,bags:P,mod:D}=ae(j,S,p),T=[...a];T[i]={...a[i],score2:A,bags2:P,mod2:D},n({...s,data:T})}},addScore:l=>{var Z;if(((Z=a[a.length-1])==null?void 0:Z.score1)!==void 0)return;const i=[...a],{score1:m,bags1:j,score2:S,bags2:p}=a[a.length-2]||{},{score:A,bags:P,mod:D,lifeBags:T}=te({...r[0],made:l[0]},{...r[2],made:l[2]},m||0,j||0),{score:be,bags:je,mod:fe,lifeBags:ue}=te({...r[1],made:l[1]},{...r[3],made:l[3]},S||0,p||0);i[a.length-1]={...a[a.length-1],score1:A,bags1:P,mod1:D,score2:be,bags2:je,mod2:fe};const I=[...b],z=(d+0)%4,G=(d+1)%4,N=(d+2)%4,W=(d+3)%4,K=[...o];r.forEach((Be,f)=>{I[f][0]+=r[f].bid===0?1:0,I[f][1]+=r[f].blind?1:0,I[f][2]+=l[f]===0?1:0,!(f===z&&r[N].bid===0&&!r[N].blind||f===G&&r[W].bid===0&&!r[W].blind||(f===z||f===N)&&r[G].bid+r[W].bid>l[G]+l[W]||(f===G||f===W)&&r[z].bid+r[N].bid>l[z]+l[N])&&(K[f]+=Math.max(Math.min(l[f]-Be.bid,f===0||f===2?T:ue),0))}),K[r.length]+=.25,n({...s,data:i,first:(d+1)%4,lastBid:[x,x,x,x],overBids:K,nils:I})},newGame:()=>{const{score1:l,bags1:i}=a[a.length-1],{score2:m,bags2:j}=a[a.length-1],S=l===m&&(i||0)>(j||0)||(l||0)>(m||0);n({...s,data:[],lastBid:[x,x,x,x],wins1:c+(S?1:0),wins2:h+(S?0:1),total1:g+(l||0)*10+(i||0),total2:B+(m||0)*10+(j||0)})}}},We=({initials:e,wins1:s,wins2:n})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex-container",children:[t.jsx(J,{variant:"h2",component:"h1",children:"♠️🧮"}),t.jsx(O,{avatar:t.jsx(V,{children:e[0]+e[2]}),color:X(s,n),label:s}),t.jsx(O,{avatar:t.jsx(V,{children:e[1]+e[3]}),color:X(n,s),label:n}),t.jsx(Ce,{})]})}),$e=M.memo(()=>{var i,m,j,S,p,A;const{data:e,initials:s,overBids:n,wins1:a,wins2:d,newGame:r,first:o,lastBid:c,addBid:h,addPenalty:g,addScore:B}=Ne();let b=e.length-1;((i=e[b])==null?void 0:i.score1)===void 0&&(b-=1);const v=((m=e[b])==null?void 0:m.score1)||0,y=((j=e[b])==null?void 0:j.bags1)||0,w=((S=e[b])==null?void 0:S.score2)||0,k=((p=e[b])==null?void 0:p.bags2)||0,C=v*10+y-(w*10+k),l=C>0?Math.floor(C/100):Math.ceil(C/100);return t.jsxs(t.Fragment,{children:[t.jsx(We,{initials:s,wins1:a,wins2:d}),v>=100||w>=100?t.jsx(Y,{fullWidth:!0,color:"error",onClick:r,variant:"contained",sx:{marginTop:2},children:"Reset"}):t.jsx(Pe,{blindTrade:l,first:o,initials:s,overBids:n,lastBid:c,showPenalty:((A=e[0])==null?void 0:A.score1)!==void 0,onBidSave:h,onPenalty:g,onScoreSave:B}),t.jsx(De,{initials:s,data:e})]})});$e.displayName="Spades";export{$e as default};
//# sourceMappingURL=index-BDWHRui6.js.map
