import{Q as de,j as t,r as A,P as K,G as re,D as oe}from"./index-DnWZ1cTW.js";import{I as H}from"./InfoPopup-BbylT2Ls.js";import{A as U}from"./Add-CnXi9f63.js";import{R as Y}from"./Remove-ZPUbRYUQ.js";import{b as I,c as u,T as Z,a as ee}from"./TableRow-DHL7DeGI.js";import{I as W,S as F,T as _}from"./Header-DlzrTVu6.js";import{T as se}from"./TableHead-BWND1tip.js";import{G as k}from"./Grid2-BPolLltS.js";import{B as R}from"./Button-C8-DAgRS.js";import{H as ie,a as le}from"./highcharts-react.min-C7d9UYqZ.js";import{p as ce,P as me}from"./PlayerMenu-C6Oysz6J.js";import{C as O}from"./Chip-DktIzz60.js";import{A as L}from"./Avatar-CXXzj00J.js";import"./DialogTitle-C0wIZjNM.js";import"./useThemeProps-D0AXvU6S.js";import"./isMuiElement-DgsRIyB0.js";import"./Select-jHLzXRYv.js";import"./useSlotProps-7_fWOkUO.js";import"./TextField-hdvku0Gr.js";const z=0,G=13,x={bid:3,blind:!1,train:!1},he={data:[],first:0,lastBid:[x,x,x,x],overBids:[0,0,0,0,0],wins1:0,wins2:0},xe=de("spadesAtom",he),p=({id:e,blindTrade:s,canTrain:n,bid:a,blind:d,train:r,onBid:o})=>{const i=()=>o(Math.max(a-1,z),!1,!1),m=()=>o(Math.min(a+1,G),!1,!1),b=(g,v)=>o(a,v,!1),S=(g,v)=>o(a,!1,v);return t.jsxs(I,{children:[t.jsx(u,{children:e}),t.jsxs(u,{align:"center",children:[t.jsx(W,{onClick:i,disabled:a<=z,children:t.jsx(Y,{})}),a,t.jsx(W,{onClick:m,disabled:a>=G,children:t.jsx(U,{})})]}),t.jsxs(u,{align:"right",children:[t.jsx(F,{checked:d,inputProps:{"aria-label":`P${e} Blind Nil`},onChange:b,size:"small"}),s||d?s:""]}),t.jsx(u,{align:"right",children:n?t.jsx(F,{checked:r,inputProps:{"aria-label":`P${e} Trains`},onChange:S,size:"small"}):null})]})},D=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,be=({blindTrade:e,first:s,initials:n,onBidSave:a})=>{const[d,r]=A.useState([x,x,x,x]),o=(s+0)%4,i=(s+1)%4,m=(s+2)%4,b=(s+3)%4,S=y=>(l,c,h)=>{let j={bid:l,blind:c,train:h};if(c)j={bid:0,blind:c,train:!1};else if(h){let B=10;switch(y){case o:B-=d[m].bid;break;case i:B-=d[b].bid;break;case m:B-=d[o].bid;break;case b:default:B-=d[i].bid}j={bid:B,blind:!1,train:h}}else j={bid:l,blind:!1,train:!1};const f=[...d];f[y]=j,r(f)},g=()=>{a(d),r([x,x,x,x])},v=d.reduce((y,l)=>y-l.bid,13);return t.jsx(H,{title:"+ Bid",onSave:g,children:t.jsxs(Z,{"aria-label":"Bid Table",padding:"none",children:[t.jsx(se,{children:t.jsxs(I,{children:[t.jsx(u,{width:"20%",children:"P"}),t.jsxs(u,{width:"40%",align:"center",children:["Bid (",v," 💰)"]}),t.jsx(u,{width:"20%",align:"center",children:"🦮"}),t.jsx(u,{width:"20%",align:"center",children:"🚂"})]})}),t.jsxs(ee,{children:[t.jsx(p,{id:n[o]+" 🥇",...d[o],onBid:S(o),blindTrade:D(e,o)}),t.jsx(p,{id:n[i],...d[i],onBid:S(i),blindTrade:D(e,i)}),t.jsx(p,{canTrain:0<d[o].bid&&d[o].bid<10,id:n[m],...d[m],blindTrade:D(e,m),onBid:S(m)}),t.jsx(p,{canTrain:0<d[i].bid&&d[i].bid<10,id:n[b]+" 🃏",...d[b],blindTrade:D(e,b),onBid:S(b)})]})]})})},ge=({initials:e,onPenalty:s})=>t.jsx(H,{title:"Penalty",buttonVariant:"outlined",buttonColor:"error",children:t.jsxs(k,{container:!0,spacing:2,children:[t.jsx(k,{size:6,children:t.jsxs(R,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),t.jsx(k,{size:6,children:t.jsxs(R,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),$=({initial:e,lastBid:s,made:n,setMade:a})=>{const d=()=>a(Math.max(n-1,z)),r=()=>a(Math.min(n+1,G));return t.jsxs(k,{size:6,children:[t.jsxs(_,{children:[e," Bid: ",s]}),t.jsxs("div",{children:["Made:",t.jsx(W,{onClick:d,disabled:n<=z,children:t.jsx(Y,{})}),n,t.jsx(W,{onClick:r,disabled:n>=G,children:t.jsx(U,{})})]})]})},je=({initials:e,lastBid:s,onScoreSave:n})=>{const[a,d]=A.useState(3),[r,o]=A.useState(3),[i,m]=A.useState(3),[b,S]=A.useState(3),g=a+r+i+b,y=g===13?()=>{n([a,r,i,b]),d(3),o(3),m(3),S(3)}:void 0;return t.jsxs(H,{title:"+ Score",onSave:y,children:[t.jsxs(_,{color:g===13?"success":"warning",align:"center",marginBottom:1,children:[g!==13&&"⚠️"," Tricks: ",g]}),t.jsxs(k,{container:!0,spacing:2,children:[t.jsx($,{initial:e[0],lastBid:s[0].bid,made:a,setMade:d}),t.jsx($,{initial:e[1],lastBid:s[1].bid,made:r,setMade:o}),t.jsx($,{initial:e[2],lastBid:s[2].bid,made:i,setMade:m}),t.jsx($,{initial:e[3],lastBid:s[3].bid,made:b,setMade:S})]})]})},te=A.memo(({initials:e,overBids:s,color:n})=>{const a=Math.round(s[s.length-1]),d={chart:{zooming:{type:"xy"},backgroundColor:null},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!1},lineWidth:2}},title:{text:"Bags",style:{color:n}},tooltip:{shared:!0},xAxis:{crosshair:!0,categories:e.split(""),lineColor:n,labels:{style:{color:n}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:n,labels:{style:{color:n}}},series:[{name:"Bids",type:"column",data:s.slice(0,-1)},{name:"Avg",type:"spline",data:[a,a,a,a],color:n,lineWidth:5}]};return t.jsx("figure",{style:{margin:0,width:"100%"},children:t.jsx(ie,{highcharts:le,options:d})})});te.displayName="StatsBagsChart";const fe=({initials:e,overBids:s})=>{const a=K(re).mode==="light"?"black":"white";return t.jsx(H,{title:"Stats",buttonVariant:"outlined",buttonColor:"success",children:t.jsx(te,{initials:e,overBids:s,color:a})})},ue=({blindTrade:e,first:s,initials:n,overBids:a,lastBid:d,showPenalty:r,onBidSave:o,onPenalty:i,onScoreSave:m})=>t.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[t.jsx(be,{blindTrade:e,first:s,initials:n,onBidSave:o}),r&&t.jsx(ge,{initials:n,onPenalty:i}),t.jsx(fe,{initials:n,overBids:a}),t.jsx(je,{initials:n,lastBid:d,onScoreSave:m})]}),Q=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,Be=({initials:e,data:s})=>t.jsxs(Z,{"aria-label":"Bid Table",children:[t.jsx(se,{children:t.jsxs(I,{children:[t.jsx(u,{width:"10%",children:"🥇"}),t.jsxs(u,{children:["Bid",t.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),t.jsx(u,{children:e[0]+e[2]}),t.jsx(u,{children:e[1]+e[3]})]})}),t.jsx(ee,{children:s.map((n,a)=>t.jsxs(I,{children:[t.jsxs(u,{padding:a===s.length-1?"none":void 0,align:"center",children:[n.start,a===s.length-1&&(n.score1?"🃏":"🥇")]}),t.jsx(u,{children:n.bid}),t.jsxs(u,{children:[Q(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),t.jsxs(u,{children:[Q(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},a))})]}),Se=e=>e.reduce((s,n)=>n.train?s+"🚂":n.blind?s+"🦮":n.bid===0?s+"🚫":n.bid>=10?s+`,${n.bid},`:s+n.bid.toString(),""),X=(e,s,n,a)=>{let d=0,r=0,o="";if(e.blind&&s.blind)e.made===0&&s.made===0?d=80:(r=e.made+s.made,o="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?d=60:e.blind&&e.made===0||s.blind&&s.made===0?(d=30,r=e.made+s.made,o="🚫"):e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-30,r=e.made+s.made,o="🚫🚫"):e.made===0&&s.made===0?d=40:e.made===0||s.made===0?(r=e.made+s.made,o="🚫"):(d=-20,r=e.made+s.made,o="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(d=20,r=e.made+s.made-10):(d=-20,o="🚂");else{e.bid===0?e.made===0?d+=e.blind?20:10:(d-=10,r+=e.made,o="🚫"):s.bid===0&&(s.made===0?d+=s.blind?20:10:(d-=10,r+=s.made,o="🚫"));const i=e.bid+s.bid,m=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);m>=i?(d+=i,r+=m-i):(d-=i,o+="🎰")}for(;a+r>=10;)d-=9,r-=10,o+="💰";return{score:n+d,bags:a+r,mod:o}},q=(e,s,n)=>{let a=s+3,d=(n||"")+"😈",r=e;return a>=10&&(r-=9,a-=10,d+="💰"),{score:r,bags:a,mod:d}},ve=()=>{const e=K(ce),[s,n]=oe(xe),{data:a,first:d,lastBid:r,overBids:o,wins1:i,wins2:m}=s,b=e.reduce((l,c,h)=>h<4?l+c.name[0]:l,"");return{data:a,first:d,initials:b,lastBid:r,overBids:o,wins1:i,wins2:m,addBid:l=>{var h;if(a[a.length-1]&&((h=a[a.length-1])==null?void 0:h.score1)===void 0)return;const c=[...a];c.push({start:b[d],bid:Se(l)}),n({...s,data:c,lastBid:l})},addPenalty:l=>()=>{var h;let c=a.length-1;if(((h=a[c])==null?void 0:h.score1)===void 0&&(c-=1),l===0){const{score1:j,bags1:f,mod1:B}=a[c]||{};if(j===void 0||f===void 0)return;const{score:C,bags:M,mod:T}=q(j,f,B),w=[...a];w[c]={...a[c],score1:C,bags1:M,mod1:T},n({...s,data:w})}else{const{score2:j,bags2:f,mod2:B}=a[c]||{};if(j===void 0||f===void 0)return;const{score:C,bags:M,mod:T}=q(j,f,B),w=[...a];w[c]={...a[c],score2:C,bags2:M,mod2:T},n({...s,data:w})}},addScore:l=>{var V;if(((V=a[a.length-1])==null?void 0:V.score1)!==void 0)return;const c=[...a],{score1:h,bags1:j,score2:f,bags2:B}=a[a.length-2]||{},{score:C,bags:M,mod:T}=X({...r[0],made:l[0]},{...r[2],made:l[2]},h||0,j||0),{score:w,bags:E,mod:ae}=X({...r[1],made:l[1]},{...r[3],made:l[3]},f||0,B||0);c[a.length-1]={...a[a.length-1],score1:C,bags1:M,mod1:T,score2:w,bags2:E,mod2:ae};const N=[...o];r.forEach((ne,P)=>{P===0&&r[2].bid===0||P===1&&r[3].bid===0||(N[P]+=Math.min(l[P]-ne.bid,P===0||P===2?M||0:E||0))}),N[r.length]+=.25,n({...s,data:c,first:(d+1)%4,lastBid:[x,x,x,x],overBids:N})},newGame:()=>{const{score1:l,bags1:c}=a[a.length-1],{score2:h,bags2:j}=a[a.length-1],f=l===h&&(c||0)>(j||0)||(l||0)>(h||0);n({...s,data:[],lastBid:[x,x,x,x],wins1:i+(f?1:0),wins2:m+(f?0:1)})}}},J=(e,s)=>e===s?"default":e>s?"success":"error",we=({initials:e,wins1:s,wins2:n})=>t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex-container",children:[t.jsx(_,{variant:"h2",component:"h1",children:"♠️🧮"}),t.jsx(O,{avatar:t.jsx(L,{children:e[0]+e[2]}),color:J(s,n),label:s}),t.jsx(O,{avatar:t.jsx(L,{children:e[1]+e[3]}),color:J(n,s),label:n}),t.jsx(me,{})]})}),ye=A.memo(()=>{var f,B,C,M,T,w;const{data:e,initials:s,overBids:n,wins1:a,wins2:d,newGame:r,first:o,lastBid:i,addBid:m,addPenalty:b,addScore:S}=ve();let g=e.length-1;((f=e[g])==null?void 0:f.score1)===void 0&&(g-=1);const v=((B=e[g])==null?void 0:B.score1)||0,y=((C=e[g])==null?void 0:C.bags1)||0,l=((M=e[g])==null?void 0:M.score2)||0,c=((T=e[g])==null?void 0:T.bags2)||0,h=v*10+y-(l*10+c),j=h>0?Math.floor(h/100):Math.ceil(h/100);return t.jsxs(t.Fragment,{children:[t.jsx(we,{initials:s,wins1:a,wins2:d}),v>=100||l>=100?t.jsx(R,{fullWidth:!0,color:"error",onClick:r,variant:"contained",sx:{marginTop:2},children:"Reset"}):t.jsx(ue,{blindTrade:j,first:o,initials:s,overBids:n,lastBid:i,showPenalty:((w=e[0])==null?void 0:w.score1)!==void 0,onBidSave:m,onPenalty:b,onScoreSave:S}),t.jsx(Be,{initials:s,data:e})]})});ye.displayName="Spades";export{ye as default};
//# sourceMappingURL=index-XF9OIE4b.js.map
