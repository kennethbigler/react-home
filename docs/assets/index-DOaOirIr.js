import{O as ae,j as a,r as A,M as de,A as ne}from"./index-v6T3YN2J.js";import{I as E}from"./InfoPopup-ePdaP4QK.js";import{A as J}from"./Add-BhtoBzP1.js";import{R as K}from"./Remove-DjlMt5u7.js";import{b as N,c as B,T as L,a as Q}from"./TableRow-_hlXf72j.js";import{I as z,S as V,T as H}from"./Header-FKXbBZOK.js";import{T as U}from"./TableHead-MnIo3Pv-.js";import{G as k}from"./Grid2-CJHt8Xno.js";import{B as p}from"./Button-Ce5UmWGb.js";import{p as re,P as te}from"./PlayerMenu-BQgil2ok.js";import{C as W}from"./Chip-DhF9inw8.js";import{A as _}from"./Avatar-DTYTL6vs.js";import"./DialogTitle-MRnOW0Dh.js";import"./useId-BfRL3J3S.js";import"./useThemeProps-BE3b7UDM.js";import"./isMuiElement-DTFLZQvR.js";import"./Select-DQwqUpk-.js";import"./useSlotProps-YmUZCgpF.js";import"./TextField-DXdgzJW5.js";const G=0,R=13,x={bid:3,blind:!1,train:!1},oe={bags:[0,0,0,0],data:[],first:0,lastBid:[x,x,x,x],wins1:0,wins2:0},ie=ae("spadesAtom",oe),C=({id:e,blindTrade:s,canTrain:n,bid:t,blind:d,train:o,onBid:r})=>{const c=()=>r(Math.max(t-1,G),!1,!1),j=()=>r(Math.min(t+1,R),!1,!1),u=(b,w)=>r(t,w,!1),S=(b,w)=>r(t,!1,w);return a.jsxs(N,{children:[a.jsx(B,{children:e}),a.jsxs(B,{align:"center",children:[a.jsx(z,{onClick:c,disabled:t<=G,children:a.jsx(K,{})}),t,a.jsx(z,{onClick:j,disabled:t>=R,children:a.jsx(J,{})})]}),a.jsxs(B,{align:"right",children:[a.jsx(V,{checked:d,inputProps:{"aria-label":`P${e} Blind Nil`},onChange:u,size:"small"}),s||d?s:""]}),a.jsx(B,{align:"right",children:n?a.jsx(V,{checked:o,inputProps:{"aria-label":`P${e} Trains`},onChange:S,size:"small"}):null})]})},I=(e,s)=>e<0&&(s===0||s===2)||e>0&&(s===1||s===3)?Math.min(Math.abs(e),3):0,ce=({blindTrade:e,first:s,initials:n,onBidSave:t})=>{const[d,o]=A.useState([x,x,x,x]),r=(s+0)%4,c=(s+1)%4,j=(s+2)%4,u=(s+3)%4,S=v=>(M,m,l)=>{let g={bid:M,blind:m,train:l};if(m)g={bid:0,blind:m,train:!1};else if(l){let i=10;switch(v){case r:i-=d[j].bid;break;case c:i-=d[u].bid;break;case j:i-=d[r].bid;break;case u:default:i-=d[c].bid}g={bid:i,blind:!1,train:l}}else g={bid:M,blind:!1,train:!1};const h=[...d];h[v]=g,o(h)},b=()=>{t(d),o([x,x,x,x])},w=d.reduce((v,M)=>v-M.bid,13);return a.jsx(E,{title:"+ Bid",onSave:b,children:a.jsxs(L,{"aria-label":"Bid Table",padding:"none",children:[a.jsx(U,{children:a.jsxs(N,{children:[a.jsx(B,{width:"20%",children:"P"}),a.jsxs(B,{width:"40%",align:"center",children:["Bid (",w," 💰)"]}),a.jsx(B,{width:"20%",align:"center",children:"🦮"}),a.jsx(B,{width:"20%",align:"center",children:"🚂"})]})}),a.jsxs(Q,{children:[a.jsx(C,{id:n[r]+" 🥇",...d[r],onBid:S(r),blindTrade:I(e,r)}),a.jsx(C,{id:n[c],...d[c],onBid:S(c),blindTrade:I(e,c)}),a.jsx(C,{canTrain:0<d[r].bid&&d[r].bid<10,id:n[j],...d[j],blindTrade:I(e,j),onBid:S(j)}),a.jsx(C,{canTrain:0<d[c].bid&&d[c].bid<10,id:n[u]+" 🃏",...d[u],blindTrade:I(e,u),onBid:S(u)})]})]})})},le=({initials:e,onPenalty:s})=>a.jsx(E,{title:"Penalty",children:a.jsxs(k,{container:!0,spacing:2,children:[a.jsx(k,{size:6,children:a.jsxs(p,{fullWidth:!0,variant:"contained",color:"error",onClick:s(0),children:["Team ",e[0]+e[2]]})}),a.jsx(k,{size:6,children:a.jsxs(p,{fullWidth:!0,variant:"contained",color:"error",onClick:s(1),children:["Team ",e[1]+e[3]]})})]})}),D=({initial:e,lastBid:s,made:n,setMade:t})=>{const d=()=>t(Math.max(n-1,G)),o=()=>t(Math.min(n+1,R));return a.jsxs(k,{size:6,children:[a.jsxs(H,{children:[e," Bid: ",s]}),a.jsxs("div",{children:["Made:",a.jsx(z,{onClick:d,disabled:n<=G,children:a.jsx(K,{})}),n,a.jsx(z,{onClick:o,disabled:n>=R,children:a.jsx(J,{})})]})]})},me=({initials:e,lastBid:s,onScoreSave:n})=>{const[t,d]=A.useState(3),[o,r]=A.useState(3),[c,j]=A.useState(3),[u,S]=A.useState(3),b=t+o+c+u,v=b===13?()=>{n([t,o,c,u]),d(3),r(3),j(3),S(3)}:void 0;return a.jsxs(E,{title:"+ Score",onSave:v,children:[a.jsxs(H,{color:b===13?"success":"warning",align:"center",marginBottom:1,children:[b!==13&&"⚠️"," Tricks: ",b]}),a.jsxs(k,{container:!0,spacing:2,children:[a.jsx(D,{initial:e[0],lastBid:s[0].bid,made:t,setMade:d}),a.jsx(D,{initial:e[1],lastBid:s[1].bid,made:o,setMade:r}),a.jsx(D,{initial:e[2],lastBid:s[2].bid,made:c,setMade:j}),a.jsx(D,{initial:e[3],lastBid:s[3].bid,made:u,setMade:S})]})]})},he=({blindTrade:e,first:s,initials:n,lastBid:t,showPenalty:d,onBidSave:o,onPenalty:r,onScoreSave:c})=>a.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[a.jsx(ce,{blindTrade:e,first:s,initials:n,onBidSave:o}),d&&a.jsx(le,{initials:n,onPenalty:r}),a.jsx(me,{initials:n,lastBid:t,onScoreSave:c})]}),X=(e,s)=>e===void 0||s===void 0||e===0?"":e>0?`${e>=100&&e>=s?"🎉 ":""}${e}`:`${e}0 + `,xe=({initials:e,data:s})=>a.jsxs(L,{"aria-label":"Bid Table",children:[a.jsx(U,{children:a.jsxs(N,{children:[a.jsx(B,{width:"10%",children:"🥇"}),a.jsxs(B,{children:["Bid",a.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),a.jsx(B,{children:e[0]+e[2]}),a.jsx(B,{children:e[1]+e[3]})]})}),a.jsx(Q,{children:s.map((n,t)=>a.jsxs(N,{children:[a.jsxs(B,{padding:t===s.length-1?"none":void 0,align:"center",children:[n.start,t===s.length-1&&(n.score1?"🃏":"🥇")]}),a.jsx(B,{children:n.bid}),a.jsxs(B,{children:[X(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),a.jsxs(B,{children:[X(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},t))})]}),q=(e,s,n,t)=>{let d=0,o=0,r="";if(e.blind&&s.blind)e.made===0&&s.made===0?d=80:(o=e.made+s.made,r="🚫🚫");else if(e.bid===0&&s.bid===0)e.blind||s.blind?e.made===0&&s.made===0?d=60:e.blind&&e.made===0||s.blind&&s.made===0?(d=30,o=e.made+s.made,r="🚫"):e.made===0||s.made===0?(o=e.made+s.made,r="🚫"):(d=-30,o=e.made+s.made,r="🚫🚫"):e.made===0&&s.made===0?d=40:e.made===0||s.made===0?(o=e.made+s.made,r="🚫"):(d=-20,o=e.made+s.made,r="🚫🚫");else if(e.train||s.train)e.made+s.made>=10?(d=20,o=e.made+s.made-10):(d=-20,r="🚂");else{e.bid===0?e.made===0?d+=e.blind?20:10:(d-=10,o+=e.made,r="🚫"):s.bid===0&&(s.made===0?d+=s.blind?20:10:(d-=10,o+=s.made,r="🚫"));const c=e.bid+s.bid,j=(e.bid>0?e.made:0)+(s.bid>0?s.made:0);j>=c?(d+=c,o+=j-c):(d-=c,r+="🎰")}for(;t+o>=10;)d-=9,o-=10,r+="💰";return{score:n+d,bags:t+o,mod:r}},je=()=>{const e=de(re),[s,n]=ne(ie),{bags:t,data:d,first:o,lastBid:r,wins1:c,wins2:j}=s,u=e[0].name[0]+e[1].name[0]+e[2].name[0]+e[3].name[0],S=m=>{var h;if(d[d.length-1]&&((h=d[d.length-1])==null?void 0:h.score1)===void 0)return;const l=[...d],g={start:u[o],bid:m.reduce((i,f)=>f.train?i+"🚂":f.blind?i+"🦮":f.bid===0?i+"🚫":f.bid>=10?i+`,${f.bid},`:i+f.bid.toString(),"")};l.push(g),n({...s,data:l,lastBid:m})},b=(m,l,g)=>{let h=l+3,i=(g||"")+"😈",f=m;return h>=10&&(f-=9,h-=10,i+="💰"),{score:f,bags:h,mod:i}};return{bags:t,data:d,first:o,initials:u,lastBid:r,wins1:c,wins2:j,addBid:S,addPenalty:m=>()=>{var g;let l=d.length-1;if(((g=d[l])==null?void 0:g.score1)===void 0&&(l-=1),m===0){const{score1:h,bags1:i,mod1:f}=d[l]||{};if(h===void 0||i===void 0)return;const{score:T,bags:P,mod:$}=b(h,i,f),y=[...d];y[l]={...d[l],score1:T,bags1:P,mod1:$},n({...s,data:y})}else{const{score2:h,bags2:i,mod2:f}=d[l]||{};if(h===void 0||i===void 0)return;const{score:T,bags:P,mod:$}=b(h,i,f),y=[...d];y[l]={...d[l],score2:T,bags2:P,mod2:$},n({...s,data:y})}},addScore:m=>{var F;if(((F=d[d.length-1])==null?void 0:F.score1)!==void 0)return;const l=[...d],{score1:g,bags1:h,score2:i,bags2:f}=d[d.length-2]||{},{score:T,bags:P,mod:$}=q({...r[0],made:m[0]},{...r[2],made:m[2]},g||0,h||0),{score:y,bags:Y,mod:Z}=q({...r[1],made:m[1]},{...r[3],made:m[3]},i||0,f||0);l[d.length-1]={...d[d.length-1],score1:T,bags1:P,mod1:$,score2:y,bags2:Y,mod2:Z};const ee=t.map((se,O)=>se+Math.max(m[O]-r[O].bid,0));n({...s,bags:ee,data:l,first:(o+1)%4,lastBid:[x,x,x,x]})},newGame:()=>{const{score1:m,bags1:l}=d[d.length-1],{score2:g,bags2:h}=d[d.length-1],i=m===g&&(l||0)>(h||0)||(m||0)>(g||0);n({...s,data:[],lastBid:[x,x,x,x],wins1:c+(i?1:0),wins2:j+(i?0:1)})}}},be=({initials:e,wins1:s,wins2:n,bags:t})=>a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex-container",children:[a.jsx(H,{variant:"h2",component:"h1",children:"♠️ Scores"}),a.jsx(te,{})]}),a.jsxs("div",{className:"flex-container",children:[a.jsx(W,{avatar:a.jsx(_,{children:e[0]+e[2]}),color:s>=n?"success":"error",label:s}),a.jsx(W,{avatar:a.jsx(_,{children:"💰"}),color:"warning",label:`${e[0]} ${t[0]} | ${e[1]} ${t[1]} | ${e[2]} ${t[2]} | ${e[3]} ${t[3]}`}),a.jsx(W,{avatar:a.jsx(_,{children:e[1]+e[3]}),color:n>=s?"success":"error",label:n})]})]}),ge=A.memo(()=>{var M,m,l,g,h,i,f,T;const{bags:e,data:s,first:n,initials:t,lastBid:d,wins1:o,wins2:r,addBid:c,addPenalty:j,addScore:u,newGame:S}=je();let b=s.length-1;((M=s[b])==null?void 0:M.score1)===void 0&&(b-=1);const w=(((m=s[b])==null?void 0:m.score1)||0)*10+(((l=s[b])==null?void 0:l.bags1)||0)-((((g=s[b])==null?void 0:g.score2)||0)*10+(((h=s[b])==null?void 0:h.bags2)||0)),v=w>0?Math.floor(w/100):Math.ceil(w/100);return a.jsxs(a.Fragment,{children:[a.jsx(be,{initials:t,wins1:o,wins2:r,bags:e}),(((i=s[s.length-1])==null?void 0:i.score1)||0)>=100||(((f=s[s.length-1])==null?void 0:f.score2)||0)>=100?a.jsx(p,{fullWidth:!0,color:"error",onClick:S,variant:"contained",sx:{marginTop:2},children:"Reset"}):a.jsx(he,{blindTrade:v,first:n,initials:t,lastBid:d,showPenalty:((T=s[b])==null?void 0:T.score1)!==void 0,onBidSave:c,onPenalty:j,onScoreSave:u}),a.jsx(xe,{initials:t,data:s})]})});ge.displayName="Spades";export{ge as default};
//# sourceMappingURL=index-DOaOirIr.js.map
