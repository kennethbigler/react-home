import{Q as fe,j as s,r as P,P as X,G as ue,D as Be}from"./index-CFEZDGt8.js";import{I as L}from"./InfoPopup-BF6YCY13.js";import{A as se}from"./Add-DotBvWAI.js";import{R as te}from"./Remove-CZjLXxtf.js";import{b as H,c as f,T as ae,a as ne}from"./TableRow-D-GVFg_P.js";import{I as R,S as K,T as N}from"./Header-BzF0YqyK.js";import{T as de}from"./TableHead-rStQi8dG.js";import{G as $}from"./Grid2-Dc6KdtRO.js";import{B as q}from"./Button-C4Q2sm9s.js";import{H as Se,a as ve}from"./highcharts-react.min-BaqWT80h.js";import{C as _}from"./Chip-okryiOvg.js";import{A as E}from"./Avatar-DWsgzX1N.js";import{p as we,P as ye}from"./PlayerMenu-BRyT8phd.js";import"./DialogTitle-9jNm3Olu.js";import"./useThemeProps--X1EpolI.js";import"./isMuiElement-DrtJP8nr.js";import"./Select-UQRhf0pf.js";import"./useSlotProps-Kv4Nz5BC.js";import"./TextField-B9bsVL05.js";const F=0,V=13,x={bid:3,blind:!1,train:!1},Me={data:[],first:0,lastBid:[x,x,x,x],overBids:[0,0,0,0,0],wins1:0,wins2:0,total1:0,total2:0,nils:[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},re=fe("spadesAtom",Me),I=({id:e,blindTrade:t,canTrain:n,bid:a,blind:d,train:r,onBid:o})=>{const l=()=>o(Math.max(a-1,F),!1,!1),c=()=>o(Math.min(a+1,V),!1,!1),b=(g,S)=>o(a,S,!1),u=(g,S)=>o(a,!1,S);return s.jsxs(H,{children:[s.jsx(f,{children:e}),s.jsxs(f,{align:"center",children:[s.jsx(R,{onClick:l,disabled:a<=F,children:s.jsx(te,{})}),a,s.jsx(R,{onClick:c,disabled:a>=V,children:s.jsx(se,{})})]}),s.jsxs(f,{align:"right",children:[s.jsx(K,{checked:d,slotProps:{input:{"aria-label":`P${e} Blind Nil`}},onChange:b,size:"small"}),t||d?t:""]}),s.jsx(f,{align:"right",children:n?s.jsx(K,{checked:r,slotProps:{input:{"aria-label":`P${e} Trains`}},onChange:u,size:"small"}):null})]})},z=(e,t)=>e<0&&(t===0||t===2)||e>0&&(t===1||t===3)?Math.min(Math.abs(e),3):0,Ae=({blindTrade:e,first:t,initials:n,onBidSave:a})=>{const[d,r]=P.useState([x,x,x,x]),o=(t+0)%4,l=(t+1)%4,c=(t+2)%4,b=(t+3)%4,u=w=>(y,k,M)=>{let i={bid:y,blind:k,train:M};if(k)i={bid:0,blind:k,train:!1};else if(M){let m=10;switch(w){case o:m-=d[c].bid;break;case l:m-=d[b].bid;break;case c:m-=d[o].bid;break;case b:default:m-=d[l].bid}i={bid:m,blind:!1,train:M}}else i={bid:y,blind:!1,train:!1};const h=[...d];h[w]=i,r(h)},g=()=>{a(d),r([x,x,x,x])},S=d.reduce((w,y)=>w-y.bid,13);return s.jsx(L,{title:"+ Bid",onSave:g,children:s.jsxs(ae,{"aria-label":"Bid Table",padding:"none",children:[s.jsx(de,{children:s.jsxs(H,{children:[s.jsx(f,{width:"20%",children:"P"}),s.jsxs(f,{width:"40%",align:"center",children:["Bid (",S," 💰)"]}),s.jsx(f,{width:"20%",align:"center",children:"🦮"}),s.jsx(f,{width:"20%",align:"center",children:"🚂"})]})}),s.jsxs(ne,{children:[s.jsx(I,{id:n[o]+" 🥇",...d[o],onBid:u(o),blindTrade:z(e,o)}),s.jsx(I,{id:n[l],...d[l],onBid:u(l),blindTrade:z(e,l)}),s.jsx(I,{canTrain:0<d[o].bid&&d[o].bid<10,id:n[c],...d[c],blindTrade:z(e,c),onBid:u(c)}),s.jsx(I,{canTrain:0<d[l].bid&&d[l].bid<10,id:n[b]+" 🃏",...d[b],blindTrade:z(e,b),onBid:u(b)})]})]})})},Te=({initials:e,onPenalty:t})=>s.jsx(L,{title:"Penalty",buttonVariant:"outlined",buttonColor:"error",children:s.jsxs($,{container:!0,spacing:2,children:[s.jsx($,{size:6,children:s.jsxs(q,{fullWidth:!0,variant:"contained",color:"error",onClick:t(0),children:["Team ",e[0]+e[2]]})}),s.jsx($,{size:6,children:s.jsxs(q,{fullWidth:!0,variant:"contained",color:"error",onClick:t(1),children:["Team ",e[1]+e[3]]})})]})}),G=({initial:e,lastBid:t,made:n,setMade:a})=>{const d=()=>a(Math.max(n-1,F)),r=()=>a(Math.min(n+1,V));return s.jsxs($,{size:6,children:[s.jsxs(N,{children:[e," Bid: ",t]}),s.jsxs("div",{children:["Made:",s.jsx(R,{onClick:d,disabled:n<=F,children:s.jsx(te,{})}),n,s.jsx(R,{onClick:r,disabled:n>=V,children:s.jsx(se,{})})]})]})},Ce=({initials:e,lastBid:t,onScoreSave:n})=>{const[a,d]=P.useState(3),[r,o]=P.useState(3),[l,c]=P.useState(3),[b,u]=P.useState(3),g=a+r+l+b,w=g===13?()=>{n([a,r,l,b]),d(3),o(3),c(3),u(3)}:void 0;return s.jsxs(L,{title:"+ Score",onSave:w,children:[s.jsxs(N,{color:g===13?"success":"warning",align:"center",marginBottom:1,children:[g!==13&&"⚠️"," Tricks: ",g]}),s.jsxs($,{container:!0,spacing:2,children:[s.jsx(G,{initial:e[0],lastBid:t[0].bid,made:a,setMade:d}),s.jsx(G,{initial:e[1],lastBid:t[1].bid,made:r,setMade:o}),s.jsx(G,{initial:e[2],lastBid:t[2].bid,made:l,setMade:c}),s.jsx(G,{initial:e[3],lastBid:t[3].bid,made:b,setMade:u})]})]})},oe=P.memo(({initials:e,overBids:t,color:n})=>{const a=Math.round(t[t.length-1]),d={chart:{zooming:{type:"xy"},backgroundColor:null},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{marker:{enabled:!1},lineWidth:2}},title:{text:"Bags",style:{color:n}},tooltip:{shared:!0},xAxis:{crosshair:!0,categories:e.split(""),lineColor:n,labels:{style:{color:n}}},yAxis:{floor:0,gridLineDashStyle:"Dot",allowDecimals:!1,title:{text:void 0},lineColor:n,labels:{style:{color:n}}},series:[{name:"Bids",type:"column",data:t.slice(0,-1)},{name:"Avg",type:"spline",data:[a,a,a,a],color:n,lineWidth:5}]};return s.jsx("figure",{style:{margin:0,width:"100%"},children:s.jsx(Se,{highcharts:ve,options:d})})});oe.displayName="StatsBagsChart";const U=e=>e.reduce((t,n)=>n.train?t+"🚂":n.blind?t+"🦮":n.bid===0?t+"🚫":n.bid>=10?t+`,${n.bid},`:t+n.bid.toString(),""),Y=(e,t,n,a)=>{let d=0,r=0,o="";if(e.blind&&t.blind)e.made===0&&t.made===0?d=80:(r=e.made+t.made,o="🚫🚫");else if(e.bid===0&&t.bid===0)e.blind||t.blind?e.made===0&&t.made===0?d=60:e.blind&&e.made===0||t.blind&&t.made===0?(d=30,r=e.made+t.made,o="🚫"):e.made===0||t.made===0?(r=e.made+t.made,o="🚫"):(d=-30,r=e.made+t.made,o="🚫🚫"):e.made===0&&t.made===0?d=40:e.made===0||t.made===0?(r=e.made+t.made,o="🚫"):(d=-20,r=e.made+t.made,o="🚫🚫");else if(e.train||t.train)e.made+t.made>=10?(d=20,r=e.made+t.made-10):(d=-20,o="🚂");else{e.bid===0?e.made===0?d+=e.blind?20:10:(d-=10,r+=e.made,o="🚫"):t.bid===0&&(t.made===0?d+=t.blind?20:10:(d-=10,r+=t.made,o="🚫"));const c=e.bid+t.bid,b=(e.bid>0?e.made:0)+(t.bid>0?t.made:0);b>=c?(d+=c,r+=b-c):(d-=c,o+="🎰")}const l=r;for(;a+r>=10;)d-=9,r-=10,o+="💰";return{score:n+d,bags:a+r,mod:o,lifeBags:l}},Z=(e,t,n)=>{let a=t+3,d=(n||"")+"😈",r=e;return a>=10&&(r-=9,a-=10,d+="💰"),{score:r,bags:a,mod:d}},O=(e,t)=>e===t?"default":e>t?"success":"error",Pe=({initials:e,overBids:t})=>{const n=X(ue),{total1:a,total2:d,nils:r}=X(re),o=n.mode==="light"?"black":"white";return s.jsx(L,{title:"Stats",buttonVariant:"outlined",buttonColor:"success",children:s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex-container",children:[s.jsx(N,{children:"Totals:"}),s.jsx(_,{avatar:s.jsx(E,{children:e[0]+e[2]}),color:O(a,d),label:a}),s.jsx(_,{avatar:s.jsx(E,{children:e[1]+e[3]}),color:O(d,a),label:d})]}),s.jsx(oe,{initials:e,overBids:t,color:o}),s.jsx("div",{style:{textAlign:"center"},children:r.map((l,c)=>s.jsx(N,{children:`Bid: ${l[0]}, Blind: ${l[1]}, Won: ${l[2]}`},c))})]})})},ke=({blindTrade:e,first:t,initials:n,overBids:a,lastBid:d,showPenalty:r,onBidSave:o,onPenalty:l,onScoreSave:c})=>s.jsxs("div",{className:"flex-container",style:{margin:"20px 0"},children:[s.jsx(Ae,{blindTrade:e,first:t,initials:n,onBidSave:o}),r&&s.jsx(Te,{initials:n,onPenalty:l}),s.jsx(Pe,{initials:n,overBids:a}),s.jsx(Ce,{initials:n,lastBid:d,onScoreSave:c})]}),ee=(e,t)=>e===void 0||t===void 0||e===0?"":e>0?`${e>=100&&e>=t?"🎉 ":""}${e}`:`${e}0 + `,pe=({initials:e,data:t})=>s.jsxs(ae,{"aria-label":"Bid Table",children:[s.jsx(de,{children:s.jsxs(H,{children:[s.jsx(f,{width:"10%",children:"🥇"}),s.jsxs(f,{children:["Bid",s.jsx("br",{}),"(",e[0]+e[1]+e[2]+e[3],")"]}),s.jsx(f,{children:e[0]+e[2]}),s.jsx(f,{children:e[1]+e[3]})]})}),s.jsx(ne,{children:t.map((n,a)=>s.jsxs(H,{children:[s.jsxs(f,{padding:a===t.length-1?"none":void 0,align:"center",children:[n.start,a===t.length-1&&(n.score1?"🃏":"🥇")]}),s.jsx(f,{children:n.bid}),s.jsxs(f,{children:[ee(n.score1,n.score2),n.bags1,n.mod1&&` (${n.mod1})`]}),s.jsxs(f,{children:[ee(n.score2,n.score1),n.bags2,n.mod2&&` (${n.mod2})`]})]},a))})]}),De=()=>{const e=X(we),[t,n]=Be(re),{data:a,first:d,lastBid:r,overBids:o,wins1:l,wins2:c,total1:b,total2:u,nils:g}=t,S=e.reduce((i,h,m)=>m<4?i+h.name[0]:i,"");return{data:a,first:d,initials:S,lastBid:r,overBids:o,wins1:l,wins2:c,addBid:i=>{var m;if(a[a.length-1]&&((m=a[a.length-1])==null?void 0:m.score1)===void 0){const j=[...a];j[a.length-1].bid=U(i),n({...t,data:j,lastBid:i});return}const h=[...a];h.push({start:S[d],bid:U(i)}),n({...t,data:h,lastBid:i})},addPenalty:i=>()=>{var m;let h=a.length-1;if(((m=a[h])==null?void 0:m.score1)===void 0&&(h-=1),i===0){const{score1:j,bags1:B,mod1:A}=a[h]||{};if(j===void 0||B===void 0)return;const{score:T,bags:p,mod:D}=Z(j,B,A),C=[...a];C[h]={...a[h],score1:T,bags1:p,mod1:D},n({...t,data:C})}else{const{score2:j,bags2:B,mod2:A}=a[h]||{};if(j===void 0||B===void 0)return;const{score:T,bags:p,mod:D}=Z(j,B,A),C=[...a];C[h]={...a[h],score2:T,bags2:p,mod2:D},n({...t,data:C})}},addScore:i=>{var J;if(((J=a[a.length-1])==null?void 0:J.score1)!==void 0)return;const h=[...a],{score1:m,bags1:j,score2:B,bags2:A}=a[a.length-2]||{},{score:T,bags:p,mod:D,lifeBags:C}=Y({...r[0],made:i[0]},{...r[2],made:i[2]},m||0,j||0),{score:le,bags:ie,mod:ce,lifeBags:he}=Y({...r[1],made:i[1]},{...r[3],made:i[3]},B||0,A||0);h[a.length-1]={...a[a.length-1],score1:T,bags1:p,mod1:D,score2:le,bags2:ie,mod2:ce};const W=[...g],me=(d+0)%4,xe=(d+1)%4,be=(d+2)%4,ge=(d+3)%4,Q=[...o];r.forEach((je,v)=>{W[v][0]+=r[v].bid===0?1:0,W[v][1]+=r[v].blind?1:0,W[v][2]+=i[v]===0?1:0,!(v===me&&r[be].bid===0||v===xe&&r[ge].bid===0)&&(Q[v]+=Math.max(Math.min(i[v]-je.bid,v===0||v===2?C:he),0))}),Q[r.length]+=.25,n({...t,data:h,first:(d+1)%4,lastBid:[x,x,x,x],overBids:Q,nils:W})},newGame:()=>{const{score1:i,bags1:h}=a[a.length-1],{score2:m,bags2:j}=a[a.length-1],B=i===m&&(h||0)>(j||0)||(i||0)>(m||0);n({...t,data:[],lastBid:[x,x,x,x],wins1:l+(B?1:0),wins2:c+(B?0:1),total1:b+(i||0)*10+(h||0),total2:u+(m||0)*10+(j||0)})}}},$e=({initials:e,wins1:t,wins2:n})=>s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex-container",children:[s.jsx(N,{variant:"h2",component:"h1",children:"♠️🧮"}),s.jsx(_,{avatar:s.jsx(E,{children:e[0]+e[2]}),color:O(t,n),label:t}),s.jsx(_,{avatar:s.jsx(E,{children:e[1]+e[3]}),color:O(n,t),label:n}),s.jsx(ye,{})]})}),Ne=P.memo(()=>{var h,m,j,B,A,T;const{data:e,initials:t,overBids:n,wins1:a,wins2:d,newGame:r,first:o,lastBid:l,addBid:c,addPenalty:b,addScore:u}=De();let g=e.length-1;((h=e[g])==null?void 0:h.score1)===void 0&&(g-=1);const S=((m=e[g])==null?void 0:m.score1)||0,w=((j=e[g])==null?void 0:j.bags1)||0,y=((B=e[g])==null?void 0:B.score2)||0,k=((A=e[g])==null?void 0:A.bags2)||0,M=S*10+w-(y*10+k),i=M>0?Math.floor(M/100):Math.ceil(M/100);return s.jsxs(s.Fragment,{children:[s.jsx($e,{initials:t,wins1:a,wins2:d}),S>=100||y>=100?s.jsx(q,{fullWidth:!0,color:"error",onClick:r,variant:"contained",sx:{marginTop:2},children:"Reset"}):s.jsx(ke,{blindTrade:i,first:o,initials:t,overBids:n,lastBid:l,showPenalty:((T=e[0])==null?void 0:T.score1)!==void 0,onBidSave:c,onPenalty:b,onScoreSave:u}),s.jsx(pe,{initials:t,data:e})]})});Ne.displayName="Spades";export{Ne as default};
//# sourceMappingURL=index-BrXU1T3m.js.map
